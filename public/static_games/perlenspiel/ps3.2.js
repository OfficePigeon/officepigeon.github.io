var K=function(){"use strict";var t="POST",e="?cmd=",n="[K._sendRequest] ",r={name:"Knecht",major:2,minor:1,revision:0,server:"http://perlenspiel.cs.wpi.edu:8080/",timeout:10},a=function(t){var e;return"number"===(e=typeof t)?isNaN(t)?e="NaN":isFinite(t)||(e="Infinity"):"object"===e&&(t?t instanceof Array&&(e="array"):e="null"),e},o=["January","February","March","April","May","June","July","August","September","October","November","December"],i=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=["SUN","MON","TUE","WED","THU","FRI","SAT"],u=function(){var t,e,n,r,a,u,c,d;return(e={time:(t=new Date).getTime(),year:t.getFullYear(),month:t.getMonth(),date:t.getDate(),day:t.getDay(),hour24:t.getHours(),hour:0,minute:t.getMinutes(),second:t.getSeconds(),millisecond:t.getMilliseconds(),zone:t.getTimezoneOffset(),monthName:"",monthShort:"",dayName:"",dayShort:"",am_pm:"",monthStr:"",dayStr:"",minuteStr:"",secondStr:"",millisecondStr:"",timeStr:"",formal:"",abbrev:"",timestamp:""}).monthName=o[e.month],e.monthShort=i[e.month],e.dayName=m[e.day],e.dayShort=s[e.day],e.hour=e.hour24+1,e.hour24>11?(e.am_pm="PM",e.hour24>12&&(e.hour=e.hour24-12)):e.am_pm="AM",n=e.month<10?"0"+e.month:e.month.toString(),e.monthStr=n,r=e.date<10?"0"+e.date:e.date.toString(),e.dateStr=r,a=e.hour<10?"0"+e.hour:e.hour.toString(),e.hourStr=a,u=e.minute<10?"0"+e.minute:e.minute.toString(),e.minuteStr=u,c=e.second<10?"0"+e.second:e.second.toString(),e.secondStr=c,d=e.millisecond<10?"00"+e.millisecond:e.millisecond<100?"0"+e.millisecond:e.millisecond.toString(),e.millisecondStr=d,e.timeStr=a+":"+u+":"+c+"+"+d,e.formal=e.dayName+" "+r+" "+e.monthName+" "+e.year+" "+e.timeStr+" "+e.am_pm,e.abbrev=e.dayShort+" "+r+" "+e.monthShort+" "+e.year+" "+e.timeStr+" "+e.am_pm,e.timestamp=e.dayShort+"_"+r+"_"+e.monthShort+"_"+e.year+"_"+a+"_"+u+"_"+c+"_"+d+e.am_pm,e.hours24=e.hour24,e.hours=e.hour,e.minutes=e.minute,e.seconds=e.second,e.milliseconds=e.millisecond,e.string=e.abbrev,e},c=function(t,e){var n,r;return n="ERROR @ "+t,void 0===(r=e)&&(r=u().timestamp),console.log(n),{error:n,timestamp:r,data:null}},d=function(t,e,o,i,m,s){var d,l,S,h,y,p,f;if(d=u(),(l=!0===(f=s)||!1===f?f:null!=f&&("number"===a(f)?0!==f:K.ERROR))===K.ERROR)return m(c(n+"sync argument invalid",d.timestamp)),!1;try{S=new XMLHttpRequest}catch(t){return m(c(n+"XMLHttpRequest() init ["+t.message+"]",d.timestamp)),!1}h=encodeURI(r.server)+t+e;try{S.open(o,h,l)}catch(t){return m(c(n+"XMLHttpRequest.open() @ "+h+" ("+o+"), sync="+!l+" ["+t.message+"]",d.timestamp)),!1}y=function(){var t,e,r;if(t=S.readyState,e=S.status,t===S.DONE&&200===e){try{r=JSON.parse(S.responseText)}catch(t){return r=c(n+"JSON.parse( request.responseText ) ["+t.message+"]"),m(r),!1}m(r)}return!0},l||(S.onreadystatechange=y),i.timestamp||(i.timestamp=d.timestamp),i.timeout||(i.timeout=r.timeout);try{p=JSON.stringify(i)}catch(t){return m(c(n+"JSON.stringify( data ) ["+t.message+"]",d.timestamp)),!1}console.log("JSON: "+p);try{S.send(p)}catch(t){return m(c(n+"request.send( json ) ["+t.message+"]",d.timestamp)),!1}return!l||y()};return{ERROR:"K.ERROR",OK:"K.OK",VERIFIED:"K.VERIFIED",sendData:function(n,r,o,i,m){var s,u;return o&&"object"===a(o)?i&&"function"==typeof i?(s=e+encodeURIComponent("PS_SEND"),u={data:{email:n,username:function(t){var e,n,r,a;for(n=(e=t.split("")).length,r=0;r<n;r+=1)"."!==(a=e[r])&&"$"!==a&&"@"!==a||(e[r]="_");return e.join("")}(n),password:r,content:o}},d(K.PS.PATH,s,t,u,i,m)?K.OK:K.ERROR):"Callback function invalid":"Content object invalid"},init:function(){return r},PS:{PATH:"ps",USERS:{player:1,claypool:1,bmoriarty:1,picritz:1,jramaral:1,lrbunyea:1,jacattelona:1,ikdonkohhalm:1,aefernandes:1,mtfigueroa:1,efrost:1,apgraham:1,sthuynh:1,dejackson:1,cakocienda:1,jkreiselman:1,lliao:1,prluck:1,mamatticoli:1,vcmiller:1,jmoore2:1,pnolan:1,rcreynolds:1,lesawin:1,elshaddock:1,tmtawadros:1},BCC:null,DOMAIN:"@wpi.edu",DOMAIN_CS:"@cs.wpi.edu",sendVerifiedEmails:function(n,r,o,i){var m,s;return n&&"array"===a(n)?r&&"object"===a(r)?o&&"function"==typeof o?(m=e+encodeURIComponent("PS_EMAILS"),r.bcc=K.PS.BCC,s={data:{emails:n,content:r}},d(K.PS.PATH,m,t,s,o,i)?K.OK:K.ERROR):"Callback function invalid":"Content object invalid":"Emails array invalid"},load:function(t,n){var r,a;return n&&"function"==typeof n?(r=e+encodeURIComponent("PS_LOAD"),a={username:t},d(K.PS.PATH,r,"PUT",a,n,!1)?K.OK:K.ERROR):"Callback function invalid"},save:function(t,n,r){var a,o;return r&&"function"==typeof r?(a=e+encodeURIComponent("PS_SAVE"),o={username:t,data:n},d(K.PS.PATH,a,"PUT",o,r,!1)?K.OK:K.ERROR):"Callback function invalid"},addSuffix:function(t){return"claypool"===t?t+K.PS.DOMAIN_CS:t+K.PS.DOMAIN},init:function(){return r}}}}();

var PAD=null,PS=function(){"use strict";var y,U,A,D,x,C,L,N,k,B,w,F,M,O,_,I,c,m,Y,z,W,H,j,h,G,q,a,Q,V,J="outer",X="main",$="stsp",Z="inlabel",ee="inspan",re="inbox",te="grid",ne="footer",ie="debug",ae="monitor",oe="image_",ue=512,le=65536,se=256,v={},s=16,o=-1,E=4,fe=1.4142,l=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"],f=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"],n=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"],de={grid:{width:512,x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:!1,timeExit:0},status:{text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},fader:{active:!1,kill:!1,r:0,g:0,b:0,rgb:null,tr:0,tg:0,tb:0,trgb:0,tstr:null,step:0,rate:0,onStep:null,onEnd:null,params:null},bead:{dirty:!0,active:!0,visible:!0,planes:null,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},bgColor:{r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},fbgColor:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},radius:0,scale:100,minimum:8,data:0,exec:null,timeTouch:0,timeRelease:0,timeEnter:0,timeExit:0,border:{width:1,equal:!0,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"},max:0,gmax:0},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}},audio:{volume:.5,max_volume:1,path:"http://users.wpi.edu/~bmoriarty/ps/audio/",loop:!1,error_sound:"fx_uhoh"},font:{name:"'Droid Sans', sans-serif",file:"https://fonts.googleapis.com/css?family=Droid+Sans.css"}},ge={engine:"Perlenspiel",major:3,minor:2,revision:21,audio:null,host:{app:"",version:"",os:""},inputs:{touch:!1,gamepad:!1},date:null},ce=[],me=null,d=!1,i=0,he=1,u=null,be=0,Se=0,Re=!1,Pe=0,pe=null,g="",r=null,t=50,b=1,Ee=!1,ve=!1,Te=!1,ye=!0,Ue=!1,S=!1,Ae=!1,R=o,P=o,De=!1,xe={gamepad:null},Ce={time:0},Le=null,Ne=null,we=!1,Fe=!1,Me=0,p=0;function Oe(e){var r;return"number"===(r=typeof e)?isNaN(e)?r="NaN":isFinite(e)||(r="Infinity"):"object"===r&&(e?e instanceof Array&&(r="array"):r="null"),r}function T(e){return!0===e||!1===e?e:null!=e&&0!==e&&PS.ERROR}function _e(e,r,t,n){var i,a;return!0!==(i=e)&&!1!==i&&(i=null!==i&&(i===PS.CURRENT?r:i===PS.DEFAULT?t:"undefined"===(a=Oe(i))?n:"number"===a?0!==i:PS.ERROR)),i}function Ie(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault(),!1}var ke={r:0,g:0,b:0,a:0,rgb:0,str:""},Ke={r:0,g:0,b:0,a:0,rgb:0,str:""},Be={r:0,g:0,b:0,a:0,rgb:0,str:""};function Ye(e,r,t){var n;n=e.a*(1-r.a),t.r=Math.floor(r.r*r.a+e.r*n),t.g=Math.floor(r.g*r.a+e.g*n),t.b=Math.floor(r.b*r.a+e.b*n)}var ze={r:0,g:0,b:0,a:0,rgb:0,str:""};function We(e,r){var t;return(t=r.a)<1?(ze.rgb=e.rgb,ze.r=e.r,ze.g=e.g,ze.b=e.b,ze.a=e.a,ze.str=e.str):t<255?(ke.r=e.r,ke.g=e.g,ke.b=e.b,ke.a=1,Ke.r=r.r,Ke.g=r.g,Ke.b=r.b,Ke.a=ce[t],Ye(ke,Ke,ze),ze.a=1,ze.rgb=ze.r*le+ze.g*se+ze.b,ze.str=y[ze.r]+U[ze.g]+A[ze.b]):(ze.rgb=r.rgb,ze.r=r.r,ze.g=r.g,ze.b=r.b,ze.a=r.a,ze.str=r.str),ze}function He(e,r,t,n,i,a){var o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E,v;if(o=k.context,u=k.bead_size,l=e.left,s=e.top,d=f=u,P=(t=(g=e.border).colorNow?g.colorNow:g.color).a,a=k.colorNow?k.colorNow:k.color,i=e.bgColor,!e.visible)return o.fillStyle=a.str,void o.fillRect(l,s,f,d);b=e.size<u,S=e.radius,R=e.planes[0].color.a,p=null,(b||0<S||R<255||0<g.width&&P<255)&&(p=We(a,i),o.fillStyle=p.str,o.fillRect(l,s,f,d),b&&(l+=e.margin,s+=e.margin,f=e.size,d=e.size)),v=Math.floor(f*S/100),0<g.width&&(0<P&&(t=g.colorNow?g.colorNow:g.color,o.fillStyle=t.str,S<1?(0<(c=g.top)&&o.fillRect(l,s,f,c),0<(m=g.bottom)&&o.fillRect(l,s+d-m,f,m),0<(E=g.left)&&o.fillRect(l,s+c,E,d-c-m),0<(E=g.right)&&o.fillRect(l+f-E,s+c,E,d-c-m)):S<50?o.fillRoundedRect(l+0,s+0,f-0,d-0,v):o.fillCircle(l+0,s+0,f-0,d-0)),l+=g.left,s+=g.top,f-=g.left+g.right,d-=g.top+g.bottom,0<P&&0<S&&(p||(p=We(a,i)),o.fillStyle=p.str,S<50?o.fillRoundedRect(l+0,s+0,f-0,d-0,v):o.fillCircle(l+0,s+0,f-0,d-0))),r=e.colorNow?e.colorNow:e.color,o.fillStyle=r.str,S<1?o.fillRect(l,s,f,d):S<50?o.fillRoundedRect(l+0,s+0,f-0,d-0,v):o.fillCircle(l+0,s+0,f-0,d-0),n=(h=e.glyph).colorNow?h.colorNow:h.color,0<h.str.length&&0<n.a&&(k.context.font=h.font,o.fillStyle=n.str,o.fillText(h.str,e.left+h.x,e.top+h.y))}function je(){var e,r;for(e=(k.colorNow?k.colorNow:k.color).str,k.canvas.style.backgroundColor=e,document.body.style.backgroundColor=e,w.statusP.style.backgroundColor=e,w.inputP.style.backgroundColor=e,pe.style.backgroundColor=e,r=0;r<k.count;r+=1)He(B[r])}function Ge(e){k.colorNow=e,je()}function qe(){var e,r,t,n;r=127<(e=k.colorNow?k.colorNow:k.color).r?0:255,t=127<e.g?0:255,n=127<e.b?0:255,pe.style.color=y[r]+U[t]+A[n]}function Qe(){k.colorNow=null,qe()}function Ve(e){w.statusP.style.color=e.str,w.inputP.style.color=e.str}function Je(e,r){var t;(t=B[r]).colorNow=e,He(t)}function Xe(e,r){var t;(t=B[r]).colorNow=null,He(t)}function $e(e,r){var t;(t=B[r]).border.colorNow=e,He(t)}function Ze(e,r){var t;(t=B[r]).border.colorNow=null,He(t)}function er(e,r){var t;(t=B[r]).glyph.colorNow=e,He(t)}function rr(e,r){var t;(t=B[r]).glyph.colorNow=null,He(t)}function tr(e){e.dirty=!0,d=!0}function nr(){var e,r,t;if(i=0,d){for(e=k.count,r=0;r<e;r+=1)(t=B[r]).dirty&&(t.dirty=!1,He(t,t.color,t.border.color,t.glyph.color,t.bgColor,k.color),i+=1);d=!1}}function ir(e){("string"!=typeof e||e.length<1)&&(e="???"),PS.debug("WARNING: "+e+"\n")}var ar=!0,or=!1;function ur(){r&&(PS.timerStop(r),r=null)}function lr(e){pe.style.opacity="1.0",pe.innerHTML=g=e}function sr(e,r){var t;return Re=!1,(!e||"string"!=typeof e||e.length<1)&&(e="???"),t="ERROR: "+e,ur(),lr(t),t+="\n",ar&&r&&r.stack&&(t+=function(e){var r,t,n,i,a,o,u,l;if(console&&console.log&&console.log(e),!e.split)return e;for(i="",t=(r=e.split("\n")).length,n=0;n<t;n+=1)i+=(a=r[n],l=u=o=void 0,o="",-1!==a.search(".js")?(u=a.lastIndexOf("/")+1,3===(l=a.substr(u).replace(/^[\s\(\)]+|[\s\(\)]+$/g,"")).split(":").length&&(l=l.substr(0,l.lastIndexOf(":"))),""!==l&&(o+="    "+l+"\n")):or&&-1!==a.search(".htm")&&(o+="\n"+a),o);return i}(r.stack)+"\n"),PS.debug(t),Q&&PS.audioPlay(de.audio.error_sound,{path:de.audio.path}),PS.ERROR}function fr(r){try{throw new Error("!")}catch(e){return sr(r,e)}}function dr(){c=[],m=0}function gr(e){e.active=!1,e.kill=!1,e.r=0,e.g=0,e.b=0,e.rgb=null,e.tr=0,e.tg=0,e.tb=0,e.trgb=0,e.tstr=null,e.step=0,e.rate=0,e.onStep=null,e.onEnd=null,e.params=null,e.frames=[],e.colorNow=null}function cr(e,r,t){var n;return gr(n={element:e,exec:r,execEnd:t}),n}function mr(e,r,t,n,i,a,o,u,l){var s,f,d,g,c,m,h,b,S,R,P,p;if(e.step=0,e.frames.length=0,r!==a||t!==o||n!==u||i!==l){e.tr=a,e.tg=o,e.tb=u,e.ta=l,e.trgb=a*le+o*se+u,e.tstr=y[a]+U[o]+U[u]+D[l],b=a<(s=r)?-(r-a):a-r,S=o<(f=t)?-(t-o):o-t,R=u<(d=n)?-(n-u):u-n,P=l<(g=i)?-(i-l):l-i,c=100/(e.rate<E?1:Math.ceil(e.rate/E)),m=0;do{if(p=!1,h={},100<=(m+=c)?(h.r=a,h.g=o,h.b=u,h.a=l):(s!==a&&(s=r+m*b/100,s=Math.round(s),p=!0),h.r=s,f!==o&&(f=t+m*S/100,f=Math.round(f),p=!0),h.g=f,d!==u&&(d=n+m*R/100,d=Math.round(d),p=!0),h.b=d,g!==l&&(g=i+m*P/100,g=Math.round(g),p=!0),h.a=g),h.rgb=h.r*le+h.g*se+h.b,h.str=y[h.r]+U[h.g]+U[h.b]+D[h.a],e.frames.push(h),!p)return}while(m<100)}}function hr(e,r,t,n,i,a,o,u,l){mr(e,r,t,n,i,a,o,u,l),0<e.frames.length&&(e.kill=!1,e.active=!0,c.push(e))}function br(e,r,t,n,i){var a,o,u,l;a=e.active,e.active=!1,0<(o=e.frames.length)&&(o<=(u=e.step)&&(u=o-1),mr(e,(l=e.frames[u]).r,l.g,l.b,l.a,r,t,n,i)),0<e.frames.length&&(e.active=a)}var Sr={time:0};function Rr(){0<t?t-=1:((b-=.05)<=0&&(PS.timerStop(r),r=null,b=0,g=""),pe.style.opacity=b.toString())}function Pr(e){ur(),t=50,b=1,lr(e.toString()),r=PS.timerStart(6,Rr)}var pr={rgb:0,r:0,g:0,b:0,str:""};function Er(e){var r,t,n,i,a,o,u,l,s,f;(function(e,r,t){var n,i,a,o,u,l,s,f,d,g,c,m;for(n=r.r,i=r.g,a=r.b,o=r.a,l=(u=e.planes).length,s=0;s<l;s+=1)d=(f=u[s].color).r,g=f.g,c=f.b,0<(m=f.a)&&(m<255?(ke.r=n,ke.g=i,ke.b=a,ke.a=1,Ke.r=d,Ke.g=g,Ke.b=c,Ke.a=ce[m],Ye(ke,Ke,Be),n=Be.r,i=Be.g,a=Be.b):(n=d,i=g,a=c),o=m);d=n,g=i,c=a,m=o,t.rgb=d*le+g*se+c,t.r=d,t.g=g,t.b=c,t.a=m,t.str=y[d]+U[g]+A[c]})(e,We(k.color,e.bgColor),pr),r=pr.rgb,n=pr.r,i=pr.g,a=pr.b,o=pr.a,u=(t=e.color).r,l=t.g,s=t.b,t.a,t.rgb=r,t.r=n,t.g=i,t.b=a,t.a=o,t.str=pr.str,e.visible&&(0<(f=e.fader).rate?null!==f.rgb?hr(f,f.r,f.g,f.b,255,n,i,a,255):f.active?br(f,n,i,a,255):hr(f,u,l,s,255,n,i,a,255):tr(e))}function vr(e,r,t,n,i){var a,o,u,l;if((a=t)!==PS.CURRENT&&a!==PS.DEFAULT)if("undefined"===(l=Oe(a)))a=PS.CURRENT;else{if("number"!==l)return fr(e+"red value invalid");(a=Math.floor(a))<0?a=0:255<a&&(a=255)}if((o=n)!==PS.CURRENT&&o!==PS.DEFAULT)if("undefined"===(l=Oe(o)))o=PS.CURRENT;else{if("number"!==l)return fr(e+"green value invalid");(o=Math.floor(o))<0?o=0:255<o&&(o=255)}if((u=i)!==PS.CURRENT&&u!==PS.DEFAULT)if("undefined"===(l=Oe(u)))u=PS.CURRENT;else{if("number"!==l)return fr(e+"blue value invalid");(u=Math.floor(u))<0?u=0:255<u&&(u=255)}return r.rgb=null,r.r=a,r.g=o,r.b=u,PS.DONE}function Tr(e,r){var t,n,i,a,o;(t=Math.floor(r))<1?t=n=a=o=0:16777215<=t?(t=16777215,n=a=o=255):(n=t/le,a=(t-(i=(n=Math.floor(n))*le))/se,o=t-i-(a=Math.floor(a))*se),e.rgb=t,e.r=n,e.g=a,e.b=o}var yr={rgb:0,r:null,g:null,b:null,str:""};function Ur(e,r,t,n){var i,a,o;if((i=yr).rgb=0,i.r=null,i.g=null,i.b=null,i.str="",a=Oe(r),void 0!==t||void 0!==n){if("number"!==a&&"undefined"!==a&&r!==PS.CURRENT&&r!==PS.DEFAULT)return fr("array"===a?e+"Extraneous arguments after color array":"object"===a?e+"Extraneous arguments after color object":e+"red argument invalid");if(vr(e,i,r,t,n)===PS.ERROR)return PS.ERROR}else if("number"===a)Tr(i,r);else if("array"===a){if(r.length<1)i.rgb=PS.CURRENT;else if(vr(e,i,r[0],r[1],r[2])===PS.ERROR)return PS.ERROR}else if("object"===a)if("undefined"===(a=Oe(o=r.rgb))||null===o){if(vr(e,i,r.r,r.g,r.b)===PS.ERROR)return PS.ERROR}else if("number"===a)Tr(i,o);else{if(o!==PS.CURRENT&&o!==PS.DEFAULT)return fr(e+".rgb property invalid");i.rgb=o}else if("undefined"===a||r===PS.CURRENT)i.rgb=PS.CURRENT;else{if(r!==PS.DEFAULT)return fr(e+"color argument invalid");i.rgb=PS.DEFAULT}return i}function Ar(e){var r,t,n,i;r=k.bead_size,e.glyph.x=Math.round(r/2),t=(n=e.glyph.scale)<100?Math.round(r*n/100):r,e.glyph.size=i=Math.round(t/2),e.glyph.font=i+"px "+de.font.name,e.glyph.y=Math.round((r-i)/2+i/2)}function Dr(e){var r;e.dirty=!0,e.active=!0,e.visible=!0,e.radius=0,e.scale=100,e.minimum=de.bead.minimum,e.data=0,e.exec=null,e.colorNow=null,gr(e.fader),(r=e.color).r=255,r.g=255,r.b=255,r.a=255,r.rgb=16777215,r.str="rgba(255,255,255,1)",(r=e.bgColor).r=255,r.g=255,r.b=255,r.a=0,r.rgb=16777215,r.str="rgba(255,255,255,0)",(r=e.border).width=1,r.equal=!0,r.top=1,r.left=1,r.bottom=1,r.right=1,r.colorNow=null,gr(r.fader),(r=e.border.color).r=128,r.g=128,r.b=128,r.a=255,r.rgb=8421504,r.str="rgba(128,128,128,1)",(r=e.glyph).str="",r.code=0,r.scale=100,r.size=0,r.x=0,r.y=0,r.font=null,r.colorNow=null,gr(r.fader),(r=e.glyph.color).r=0,r.g=0,r.b=0,r.a=255,r.rgb=0,r.str="rgba(0,0,0,1)",e.planes=[{height:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}}]}function xr(e,r){var t,n,i,a,o,u;if(t=e.planes,r<1)return(n=t[0]).color;for(i=t.length,a=1;a<i;a+=1)if((n=t[a]).height===r)return n.color;if(o={rgb:(u=de.bead.color).rgb,r:u.r,g:u.g,b:u.b,a:0},e.active){for(a=0;a<i&&!((n=t[a]).height>r);)a+=1;t.splice(a,0,{height:r,color:o})}return o}function Cr(e){return 0<e.glyph.code?e.border.gmax:e.border.max}function Lr(e,r){e.border.equal=!0,e.border.width=r,e.border.top=r,e.border.left=r,e.border.bottom=r,e.border.right=r}function Nr(e){var r,t,n,i,a,o;r=k.bead_size,e.scale<100?0<(n=r-(t=Math.floor(r*e.scale/100)))&&n%2&&(t+=1):(t=r,e.margin=0,e.senseLeft=e.left,e.senseRight=e.right,e.senseTop=e.top,e.senseBottom=e.bottom),(e.size=t)!==r&&(e.margin=i=Math.floor((r-t)/2),e.senseLeft=e.left+i,e.senseRight=e.right-i,e.senseTop=e.top+i,e.senseBottom=e.bottom-i),(o=e.border).max=Math.floor((t-e.minimum)/2),o.gmax=Math.floor((t-e.glyph.size)/2),a=Cr(e),o.equal?o.width>a&&Lr(e,a):(a<o.top&&(o.top=a),a<o.left&&(o.left=a),a<o.bottom&&(o.bottom=a),a<o.right&&(o.right=a))}function wr(e){var r;return null===(r=e.data)&&(r=0),r}function Fr(e){u={start:e,end:0,duration:0,events:[]}}function Mr(e,r,t){u.events.push({x:e,y:r,start:t,end:0,duration:0})}function Or(e){var r,t;0<(r=u.events.length)&&(t=u.events[r-1],u.end=e,t.end=e,t.duration=e-t.start,u.duration+=t.duration)}function _r(e){var r,t;if(r=!1,1<u.events.length){Or(e),t=function(){var e,r,t,n;for(e={start:u.start,end:u.end,duration:u.duration,events:[]},r=u.events.length,t=0;t<r;t+=1)n=u.events[t],e.events.push({x:n.x,y:n.y,start:n.start,end:n.end,duration:n.duration});return e}();try{PS.swipe(t,{time:e}),r=!0}catch(e){return sr("PS.swipe() failed ["+e.message+"]",e)}}return u=null,r}var Ir={time:0};function kr(r){var e,t,n;if(r.active){if(t=!1,Ir.time=r.timeTouch=n=_,PS.swipe&&(Fr(n),Mr(r.x,r.y,n)),r.exec)try{e=wr(r),r.exec(r.x,r.y,e,Ir),t=!0}catch(e){return sr("Bead "+r.x+", "+r.y+" function failed ["+e.message+"]",e)}if(PS.touch)try{e=wr(r),PS.touch(r.x,r.y,e,Ir),t=!0}catch(e){return sr("PS.touch() failed ["+e.message+"]",e)}t&&nr()}return PS.DONE}var Kr={time:0};function Br(e){var r,t;if(e.active){if(e.timeRelease=t=_,PS.release){try{r=wr(e),Kr.time=t,PS.release(e.x,e.y,r,Kr)}catch(e){return sr("PS.release() failed ["+e.message+"]",e)}nr()}PS.swipe&&_r()}return PS.DONE}var Yr={time:0,touching:!1};function zr(e){var r,t;if(Ae=!0,e.active&&(e.timeEnter=r=_,S&&PS.swipe&&u&&Mr(e.x,e.y,r),PS.enter)){try{t=wr(e),Yr.time=r,Yr.touching=S,PS.enter(e.x,e.y,t,Yr)}catch(e){return sr("PS.enter() failed ["+e.message+"]",e)}nr()}return PS.DONE}var Wr={time:0,touching:!1};function Hr(e){var r,t;if(e.active&&(e.timeExit=r=_,S&&PS.swipe&&u&&Or(r),PS.exit)){try{t=wr(e),Wr.time=r,Wr.touching=S,PS.exit(e.x,e.y,t,Wr)}catch(e){return sr("PS.exit() failed ["+e.message+"]",e)}nr()}return PS.DONE}var jr={time:0,touching:!1};function Gr(){var e;if(Ae=!1,k.timeExit=e=_,PS.exitGrid){try{jr.time=e,jr.touching=S,PS.exitGrid(jr)}catch(e){return sr("PS.exitGrid() failed ["+e.message+"]",e)}nr()}return S&&PS.swipe&&u&&Mr(-1,-1,e),PS.DONE}function qr(){S=Ae=!1,u=null,a=P=R=o}function Qr(e,r){var t,n,i,a;if(t=k.canvas,e+=document.body.scrollLeft+document.documentElement.scrollLeft-t.offsetLeft-k.padLeft,r+=document.body.scrollTop+document.documentElement.scrollTop-t.offsetTop-k.padRight,e>=k.left&&e<k.right&&r>=k.top&&r<k.bottom)for(i=0;i<k.count;){if(r>=(n=B[i]).top&&r<n.bottom){for(a=0;a<k.x;a+=1){if(e>=n.senseLeft&&e<n.senseRight&&r>=n.senseTop&&r<n.senseBottom)return n;n=B[i+=1]}return null}i+=k.x}return null}function Vr(e){var r;return we&&Ne.blur(),r=_,S=!0,PS.swipe&&(Fr(r),Mr(-1,-1,r)),Ie(e)}function Jr(e){return PS.swipe&&u&&_r(_),S=!1,Ie(e)}function Xr(e){return Ne.focus(),Ie(e)}function $r(e){return Ie(e)}function Zr(e){var r,t,n;return we&&Ne.blur(),r=e.clientX,t=e.clientY,S=!0,(n=Qr(r,t))&&kr(n),Ie(e)}function et(e){var r;return(r=Qr(e.clientX,e.clientY))&&Br(r),S=!1,Ie(e)}function rt(e){var r;return(r=Qr(e.clientX,e.clientY))?r.index!==R&&(R!==o&&Hr(B[R]),zr(r),R=r.index):R!==o&&(Hr(B[R]),R=o),Ie(e)}function tt(e){var r;return R!==o&&(Hr(B[R]),R=o),(r=e.relatedTarget)&&(r=r.id)&&(r===J||r===X||r.length<1)&&Gr(),Ie(e)}function nt(e){var r,t;return we&&Ne.blur(),a!==o||(r=e.changedTouches[0],a=r.identifier,S=!0,(t=Qr(r.pageX,r.pageY))?(Ae=!0,kr(t),P=t.index):(P=o,Ae=!1)),Ie(e)}function it(e){var r,t,n,i;for(r=e.changedTouches.length,t=0;t<r;t+=1)if((n=e.changedTouches[t]).identifier===a){a=o,Ae=!1,(i=Qr(n.pageX,n.pageY))&&Br(i),P=o,S=!1;break}return Ie(e)}function at(e){var r,t,n,i;for(r=e.changedTouches.length,t=0;t<r;t+=1)if((n=e.changedTouches[t]).identifier===a){(i=Qr(n.pageX,n.pageY))?(Ae=!0,P!==i.index&&(P!==o&&Hr(B[P]),zr(i),P=i.index)):(P!==o&&Hr(B[P]),P=o,Ae&&Gr());break}return Ie(e)}function ot(){var e;for(j.length=0,Te=ve=!1,e=0;e<256;e+=1)H[e]=0}function ut(e,r){var t;return 65<=(t=e)&&t<=90?r||(t+=32):(t=Y[t],r&&t<256&&(t=z[t])),t}function lt(e){return 32<=e||13===e||8===e||9===e||27===e}function st(e){var r,t,n,i,a,o;if(t=!(r="[_keyDown] "),Fe)return!0;if(ve=e.shiftKey,Te=e.ctrlKey,e.altKey,lt(i=ut(n=e.which?e.which:e.keyCode,ve))){if(!H[i]&&(H[i]=1,i!==n&&H[n]&&(H[n]=0)<=(o=j.indexOf(n))&&j.splice(o,1),j.length<1&&(h=q),j.indexOf(i)<0&&j.push(i),PS.keyDown))try{Sr.time=_,PS.keyDown(i,ve,Te,Sr),t=!0}catch(e){sr(r+"PS.keyDown failed ["+e.message+"]",e)}}else if(i===s)for(a=j.length,o=0;o<a;o+=1)if(i=n=j[o],97<=n&&n<=122?i-=32:n<256&&(i=z[n]),i!==n&&(H[n]=0,H[i]=1,j[o]=i,PS.keyDown))try{Sr.time=_,PS.keyDown(i,!0,Te,Sr),t=!0}catch(e){sr(r+"PS.keyDown failed ["+e.message+"]",e)}return t&&nr(),Ie(e)}var ft={time:0};function dt(e){var r,t,n,i,a,o,u,l;if(t=!(r="[_keyUp] "),Fe)return!0;if(n=ve=e.shiftKey,i=Te=e.ctrlKey,lt(o=ut(a=e.which?e.which:e.keyCode,ve))){if((H[o]=0)<=(u=j.indexOf(o))&&j.splice(u,1),j.length<1&&(h=0,Te=ve=!1),PS.keyUp)try{ft.time=_,PS.keyUp(o,n,i,ft),t=!0}catch(e){sr(r+"PS.keyUp failed ["+e.message+"]",e)}}else if(o===s)for(l=j.length,u=0;u<l;u+=1)if(o=a=j[u],a<256&&(o=W[a]),o!==a&&(H[a]=0,H[o]=1,j[u]=o,PS.keyDown))try{ft.time=_,PS.keyDown(o,!1,i,ft),t=!0}catch(e){sr(r+"PS.keyDown failed ["+e.message+"]",e)}return t&&nr(),Ie(e)}var gt=function(e,r){if(PS.input){try{PS.input(e,r)}catch(e){sr("PS.input() failed ["+e.message+"]",e)}nr()}},ct={wheel:0},mt={time:0};function ht(e){var r;return!Ae||(e||(e=window.event),r=1<=(r=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)))?PS.WHEEL_FORWARD:PS.WHEEL_BACKWARD,ct.wheel=r,mt.time=_,gt(ct,mt),Ie(e))}function bt(){Ee||(ot(),document.addEventListener("keydown",st,!1),document.addEventListener("keyup",dt,!1),Ee=!0)}var St={time:0},Rt=!1;function Pt(e){var r;if(r="Are you sure you want to exit Perlenspiel?",PS.shutdown&&0<p){Rt=!0;try{St.time=_,PS.shutdown(St)}catch(e){sr("PS.shutdown() failed ["+e.message+"]",e)}}return e.returnValue=r}function pt(e){var r,t,n,i,a,o;return r=k.color,t=k.fader,(n=e.rgb)===PS.CURRENT||(null===n?((i=e.r)===PS.CURRENT?e.r=i=r.r:i===PS.DEFAULT&&(e.r=i=de.grid.color.r),(a=e.g)===PS.CURRENT?e.g=a=r.g:a===PS.DEFAULT&&(e.g=a=de.grid.color.g),(o=e.b)===PS.CURRENT?e.b=o=r.b:o===PS.DEFAULT&&(e.b=o=de.grid.color.b),e.rgb=i*le+a*se+o):n===PS.DEFAULT&&(e={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}),(r.rgb!==e.rgb||0<t.rate&&null!==t.rgb&&t.rgb!==e.rgb)&&(r.rgb=e.rgb,i=e.r,a=e.g,o=e.b,r.str=e.str=y[i]+U[a]+A[o],0<t.rate?null!==t.rgb?hr(t,t.r,t.g,t.b,255,i,a,o,255):t.active?br(t,i,a,o,255):hr(t,r.r,r.g,r.b,255,i,a,o,255):(je(),qe()),r.r=i,r.g=a,r.b=o)),r.rgb}function Et(e,r){var t,n,i,a,o,u;return t=k.shadow,(n=r.rgb)!==PS.CURRENT&&(null===n?((i=r.r)===PS.CURRENT?r.r=i=t.r:i===PS.DEFAULT&&(r.r=i=de.grid.shadow.r),(a=r.g)===PS.CURRENT?r.g=a=t.g:a===PS.DEFAULT&&(r.g=a=de.grid.shadow.g),(o=r.b)===PS.CURRENT?r.b=o=t.b:o===PS.DEFAULT&&(r.b=o=de.grid.shadow.b),r.rgb=i*le+a*se+o):n===PS.DEFAULT&&(r={show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "}),t.rgb!==r.rgb&&(t.rgb=r.rgb,i=r.r,a=r.g,o=r.b,t.str=r.str=y[i]+U[a]+A[o],t.r=i,t.g=a,t.b=o)),e!==PS.CURRENT&&(k.shadow.show=e),k.shadow.show?(u=t,k.canvas.style.boxShadow=k.shadow.params+u.str):k.canvas.style.boxShadow="none",{show:k.shadow.show,rgb:t.rgb}}function vt(e,r){var t,n,i,a,o,u,l;if(dr(),gr(k.fader),gr(w.fader),qr(),k.plane=0,k.ready&&e===k.x&&r===k.y)for(n=0;n<k.count;n+=1)Dr(l=B[n]),Nr(l),Ar(l);else{for(k.x=e,k.y=r,k.count=e*r,k.left=0,k.top=0,t=r<=e?Math.floor(L/e):Math.floor(L/r),k.bead_size=t,k.width=t*e,k.height=t*r,k.right=k.width,k.bottom=k.height,k.canvas.width=k.width,k.canvas.height=k.height,k.context.textAlign="center",k.context.textBaseline="middle",a=0,u=k.top,i=0;i<r;i+=1){for(o=k.left,n=0;n<e;n+=1)(l=B[a]).x=n,l.y=i,l.left=o,l.right=o+t,l.top=u,l.bottom=u+t,Dr(l),Nr(l),Ar(l),o+=t,a+=1;u+=t}for(;a<1024;)(l=B[a]).visible=!1,l.active=!1,a+=1}d=!0,pt({rgb:PS.DEFAULT}),PS.statusColor(PS.DEFAULT),nr(),k.ready=!0}function Tt(e,r){return"number"!==Oe(e)?fr(r+"x argument not a number"):(e=Math.floor(e))<0?fr(r+"x argument negative"):e>=k.x?fr(r+"x argument exceeds grid width"):e}function yt(e,r){return"number"!==Oe(e)?fr(r+"y argument not a number"):(e=Math.floor(e))<0?fr(r+"y argument negative"):e>=k.y?fr(r+"y argument exceeds grid height"):e}function Ut(e,r,t,n,i,a,o,u){var l,s,f;if(t===PS.ALL){if(n===PS.ALL){for(s=0;s<k.y;s+=1)for(l=0;l<k.x&&(f=r(l,s,i,a,o,u))!==PS.ERROR;l+=1);return f}if((n=yt(n,e))===PS.ERROR)return PS.ERROR;for(l=0;l<k.x&&(f=r(l,n,i,a,o,u))!==PS.ERROR;l+=1);return f}if(n===PS.ALL){if((t=Tt(t,e))===PS.ERROR)return PS.ERROR;for(s=0;s<k.y&&(f=r(t,s,i,a,o,u))!==PS.ERROR;s+=1);return f}return(t=Tt(t,e))===PS.ERROR?PS.ERROR:(n=yt(n,e))===PS.ERROR?PS.ERROR:f=r(t,n,i,a,o,u)}function At(e,r,t){var n,i,a,o,u,l,s,f,d;return n=r*k.x+e,i=B[n],a=de.bead.color,o=xr(i,k.plane),u=i.fader,l=t.rgb,i.active&&l!==PS.CURRENT&&(null===l?((s=t.r)===PS.CURRENT?t.r=s=o.r:s===PS.DEFAULT&&(t.r=s=a.r),(f=t.g)===PS.CURRENT?t.g=f=o.g:f===PS.DEFAULT&&(t.g=f=a.g),(d=t.b)===PS.CURRENT?t.b=d=o.b:d===PS.DEFAULT&&(t.b=d=a.b),t.rgb=s*le+f*se+d):l===PS.DEFAULT&&(t={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}),(o.rgb!==t.rgb||0<u.rate&&null!==u.rgb&&u.rgb!==t.rgb)&&(o.rgb=t.rgb,o.r=t.r,o.g=t.g,o.b=t.b,Er(i))),o.rgb}function Dt(e,r,t){var n,i,a;return n=r*k.x+e,a=xr(i=B[n],k.plane),i.active&&t!==PS.CURRENT&&t!==a.a&&(a.a=t,Er(i)),a.a}function xt(e,r){var t,n,i,a,o,u;if("undefined"===(t=Oe(r))||r===PS.CURRENT)return{rgb:PS.CURRENT,r:0,g:0,b:0,onStep:PS.CURRENT,onEnd:PS.CURRENT,params:PS.CURRENT};if(r===PS.DEFAULT)return{rgb:PS.DEFAULT,r:0,g:0,b:0,onStep:PS.DEFAULT,onEnd:PS.DEFAULT,params:PS.DEFAULT};if("object"!==t)return fr(e+"options argument invalid");if((n=r.rgb)!==PS.CURRENT&&n!==PS.DEFAULT)if("undefined"===(t=Oe(n))||null===n)r.rgb=PS.CURRENT;else{if("number"!==t)return fr(e+"options.rgb property invalid");(n=Math.floor(n))<=PS.COLOR_BLACK?(n=PS.COLOR_BLACK,a=o=i=0):n>=PS.COLOR_WHITE?(n=PS.COLOR_WHITE,a=o=i=255):(i=n/le,o=(n-(u=(i=Math.floor(i))*le))/se,a=n-u-(o=Math.floor(o))*se),r.rgb=n,r.r=i,r.g=o,r.b=a}else r.r=0,r.g=0,r.b=0;if((n=r.onStep)!==PS.CURRENT&&n!==PS.DEFAULT)if("undefined"===(t=Oe(n))||null===n)r.onStep=PS.CURRENT;else if("function"!==t)return fr(e+"options.onStep property invalid");if((n=r.onEnd)!==PS.CURRENT&&n!==PS.DEFAULT)if("undefined"===(t=Oe(n))||null===n)r.onEnd=PS.CURRENT;else if("function"!==t)return fr(e+"options.onEnd property invalid");if((n=r.params)!==PS.CURRENT&&n!==PS.DEFAULT)if("undefined"===(t=Oe(n))||null===n)r.params=PS.CURRENT;else if("array"!==t)return fr(e+"options.params property invalid");return r}function Ct(e,r,t,n){var i,a,o,u,l,s,f;return i=r*k.x+e,o=(a=B[i]).color,l=(u=a.fader).rate,a.active&&(s=t===PS.CURRENT?l:t===PS.DEFAULT?de.fader.rate:t,(f=n.rgb)!==PS.CURRENT&&(f===PS.DEFAULT?u.rgb=de.fader.rgb:u.rgb=f,u.r=n.r,u.g=n.g,u.b=n.b),(f=n.onStep)!==PS.CURRENT&&(f===PS.DEFAULT?u.onStep=de.fader.onStep:u.onStep=f),(f=n.onEnd)!==PS.CURRENT&&(f===PS.DEFAULT?u.onEnd=de.fader.onEnd:u.onEnd=f),(f=n.params)!==PS.CURRENT&&(f===PS.DEFAULT?u.params=de.fader.params:u.params=f),l!==s&&((u.rate=s)<1?(u.active=!1,u.kill=!0):u.active&&br(u,o.r,o.g,o.b,255))),{rate:u.rate,rgb:u.rgb,onStep:u.onStep,onEnd:u.onEnd,params:u.params}}function Lt(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&i.scale!==t&&(i.scale=t,Nr(i),tr(i)),i.scale}function Nt(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&i.radius!==t&&(i.radius=t,!i.border.equal&&0<t&&Lr(i,Math.max(i.border.top,i.border.left,i.border.bottom,i.border.right)),tr(i)),i.radius}function wt(e,r,t){var n,i,a,o,u,l,s,f;return n=r*k.x+e,i=B[n],a=de.bead.bgColor,o=i.bgColor,u=t.rgb,i.active&&u!==PS.CURRENT&&(null===u?((l=t.r)===PS.CURRENT?t.r=l=o.r:l===PS.DEFAULT&&(t.r=l=a.r),(s=t.g)===PS.CURRENT?t.g=s=o.g:s===PS.DEFAULT&&(t.g=s=a.g),(f=t.b)===PS.CURRENT?t.b=f=o.b:f===PS.DEFAULT&&(t.b=f=a.b),t.rgb=l*le+s*se+f):u===PS.DEFAULT&&(t={r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"}),o.rgb!==t.rgb&&(o.rgb=t.rgb,o.r=l=t.r,o.g=s=t.g,o.b=f=t.b,o.str=y[l]+U[s]+U[f]+D[o.a],i.active&&(i.scale<100||0<i.radius)&&tr(i))),o.rgb}function Ft(e,r,t){var n,i,a;return n=r*k.x+e,a=(i=B[n]).bgColor,t!==PS.CURRENT&&t!==a.a&&(a.a=t,a.str=y[a.r]+U[a.g]+U[a.b]+D[t],i.active&&(i.scale<100||0<i.radius)&&tr(i)),a.a}function Mt(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&(null===t?(i.data=de.bead.data,i.fader.data=i.data,i.border.fader.data=i.data,i.glyph.fader.data=i.data):(i.data=t,i.fader.data=t,i.border.fader.data=t,i.glyph.fader.data=t)),i.data}function Ot(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&(i.exec=t),i.exec}function _t(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&i.visible!==t&&((i.visible=t)||(i.fader.kill=!0,i.border.fader.kill=!0,i.glyph.fader.kill=!0),tr(i)),i.visible}function It(e,r,t){var n,i;return n=r*k.x+e,i=B[n],t!==PS.CURRENT&&(i.active=t),i.active}function kt(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&i.minimum!==t&&(t>i.size&&(t=i.size),i.minimum=t,Nr(i),tr(i)),i.minimum}function Kt(e,r,t){var n,i,a,o,u,l,s,f,d;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&(a=Cr(i),"number"===Oe(t)?(a<t&&(t=a),t!==i.border.width&&(Lr(i,t),tr(i))):(u=!1,(l=t.top)===PS.CURRENT?l=i.border.top:(a<l&&(l=a),l!==i.border.top&&(i.border.top=l,u=!0)),(s=t.left)===PS.CURRENT?s=i.border.left:(a<s&&(s=a),s!==i.border.left&&(i.border.left=s,u=!0)),(f=t.bottom)===PS.CURRENT?f=i.border.bottom:(a<f&&(f=a),f!==i.border.bottom&&(i.border.bottom=f,u=!0)),(d=t.right)===PS.CURRENT?d=i.border.right:(a<d&&(d=a),d!==i.border.right&&(i.border.right=d,u=!0)),l===s&&l===d&&l===f?(Lr(i,l),u&&tr(i)):0<i.radius?(Lr(i,a=Math.max(l,s,f,d)),tr(i)):(i.border.equal=!1,u&&tr(i)))),o={top:i.border.top,left:i.border.left,bottom:i.border.bottom,right:i.border.right,equal:i.border.equal},i.border.equal||(i.border.width=Math.max(o.top,o.left,o.bottom,o.right)),o.width=i.border.width,o}function Bt(e,r,t){var n,i,a,o,u,l,s,f,d,g;return n=r*k.x+e,a=(i=B[n]).border.color,o=i.border.fader,u=de.bead.border.color,l=t.rgb,i.active&&l!==PS.CURRENT&&(null===l?((s=t.r)===PS.CURRENT?t.r=s=a.r:s===PS.DEFAULT&&(t.r=s=u.r),(f=t.g)===PS.CURRENT?t.g=f=a.g:f===PS.DEFAULT&&(t.g=f=u.g),(d=t.b)===PS.CURRENT?t.b=d=a.b:d===PS.DEFAULT&&(t.b=d=u.b),t.rgb=s*le+f*se+d):l===PS.DEFAULT&&(t={r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}),(a.rgb!==t.rgb||0<o.rate&&null!==o.rgb&&o.rgb!==t.rgb)&&(a.rgb=t.rgb,s=t.r,f=t.g,d=t.b,t.a=g=a.a,a.str=t.str=y[s]+U[f]+U[d]+D[g],i.visible&&(0<o.rate?null!==o.rgb?hr(o,o.r,o.g,o.b,g,s,f,d,g):o.active?br(o,s,f,d,g):hr(o,a.r,a.g,a.b,g,s,f,d,g):tr(i)),a.r=s,a.g=f,a.b=d)),a.rgb}function Yt(e,r,t){var n,i,a,o,u,l,s;return n=r*k.x+e,a=(i=B[n]).border.color,i.active&&t!==PS.CURRENT&&t!==a.a&&(o=a.r,u=a.g,l=a.b,a.str=y[o]+U[u]+U[l]+D[t],i.visible&&(0<(s=i.border.fader).rate?s.active?br(s,o,u,l,t):null!==s.rgb?hr(s,s.r,s.g,s.b,a.a,o,u,l,t):hr(s,o,u,l,a.a,o,u,l,t):tr(i)),a.a=t),a.a}function zt(e,r,t,n){var i,a,o,u,l,s,f;return i=r*k.x+e,u=(a=B[i]).border.color,l=(o=a.border.fader).rate,a.active&&(s=t===PS.CURRENT?l:t===PS.DEFAULT?de.fader.rate:t,(f=n.rgb)!==PS.CURRENT&&(f===PS.DEFAULT?o.rgb=de.fader.rgb:o.rgb=f,o.r=n.r,o.g=n.g,o.b=n.b),(f=n.onStep)!==PS.CURRENT&&(f===PS.DEFAULT?o.onStep=de.fader.onStep:o.onStep=f),(f=n.onEnd)!==PS.CURRENT&&(f===PS.DEFAULT?o.onEnd=de.fader.onEnd:o.onEnd=f),(f=n.params)!==PS.CURRENT&&(f===PS.DEFAULT?o.params=de.fader.params:o.params=f),l!==s&&((o.rate=s)<1?(o.active=!1,o.kill=!0):o.active&&br(o,u.r,u.g,u.b,255))),{rate:o.rate,rgb:o.rgb,onStep:o.onStep,onEnd:o.onEnd,params:o.params}}function Wt(e,r,t){var n,i;return n=r*k.x+e,(i=B[n]).active&&t!==PS.CURRENT&&i.glyph.str!==t&&(0<(i.glyph.str=t).length?i.glyph.code=t.charCodeAt(0):i.glyph.code=0,tr(i)),i.glyph.code}function Ht(e,r,t){var n,i,a,o,u,l,s,f,d,g;return n=r*k.x+e,a=(i=B[n]).glyph.color,o=i.glyph.fader,u=de.bead.glyph.color,l=t.rgb,i.active&&l!==PS.CURRENT&&(null===l?((s=t.r)===PS.CURRENT?t.r=s=a.r:s===PS.DEFAULT&&(t.r=s=u.r),(f=t.g)===PS.CURRENT?t.g=f=a.g:f===PS.DEFAULT&&(t.g=f=u.g),(d=t.b)===PS.CURRENT?t.b=d=a.b:d===PS.DEFAULT&&(t.b=d=u.b),t.rgb=s*le+f*se+d):l===PS.DEFAULT&&(t={r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}),(a.rgb!==t.rgb||0<o.rate&&null!==o.rgb&&o.rgb!==t.rgb)&&(a.rgb=t.rgb,s=t.r,f=t.g,d=t.b,t.a=g=a.a,a.str=t.str=y[s]+U[f]+U[d]+D[g],i.visible&&(0<o.rate?null!==o.rgb?hr(o,o.r,o.g,o.b,g,s,f,d,g):o.active?br(o,s,f,d,g):hr(o,a.r,a.g,a.b,g,s,f,d,g):tr(i)),a.r=s,a.g=f,a.b=d)),a.rgb}function jt(e,r,t){var n,i,a,o,u,l,s;return n=r*k.x+e,a=(i=B[n]).glyph.color,i.active&&t!==PS.CURRENT&&t!==a.a&&(o=a.r,u=a.g,l=a.b,a.str=y[o]+U[u]+U[l]+D[t],i.visible&&(0<(s=i.glyph.fader).rate?s.active?br(s,o,u,l,t):hr(s,o,u,l,a.a,o,u,l,t):tr(i)),a.a=t),a.a}function Gt(e,r,t){var n,i,a;return n=r*k.x+e,a=(i=B[n]).glyph.scale,i.active&&t!==PS.CURRENT&&t!==a&&(i.glyph.scale=t,i.visible&&(Ar(i),tr(i))),i.glyph.scale}function qt(e,r,t,n){var i,a,o,u,l,s,f;return i=r*k.x+e,o=(a=B[i]).glyph.color,l=(u=a.glyph.fader).rate,a.active&&(s=t===PS.CURRENT?l:t===PS.DEFAULT?de.fader.rate:t,(f=n.rgb)!==PS.CURRENT&&(f===PS.DEFAULT?u.rgb=de.fader.rgb:u.rgb=f,u.r=n.r,u.g=n.g,u.b=n.b),(f=n.onStep)!==PS.CURRENT&&(f===PS.DEFAULT?u.onStep=de.fader.onStep:u.onStep=f),(f=n.onEnd)!==PS.CURRENT&&(f===PS.DEFAULT?u.onEnd=de.fader.onEnd:u.onEnd=f),(f=n.params)!==PS.CURRENT&&(f===PS.DEFAULT?u.params=de.fader.params:u.params=f),l!==s&&((u.rate=s)<1?(u.active=!1,u.kill=!0):u.active&&br(u,o.r,o.g,o.b,255))),{rate:u.rate,rgb:u.rgb,onStep:u.onStep,onEnd:u.onEnd,params:u.params}}function Qt(e){var r,t,n,i,a,o,u,l;for(r=e.getAttribute("data-id"),t=M.length,n=0;n<t;n+=1)if((i=M[n]).id===r){a=i.exec,o=i.format,u=i.source,M.splice(n,1);break}if((l=function(e,r){var t,n,i,a,o,u,l,s,f,d,g,c,m,h,b;if(t="[_imageExtract] ","number"!==Oe(n=e.width)||n<1)return fr(t+"image width invalid");if(n=Math.floor(n),"number"!==Oe(i=e.height)||i<1)return fr(t+"image height invalid");i=Math.floor(i);try{F.width=n,F.height=i,(a=F.getContext("2d")).drawImage(e,0,0,n,i,0,0,n,i)}catch(e){return sr(t+"image extraction failed @ 1 ["+e.message+"]",e)}try{o=a.getImageData(0,0,n,i)}catch(e){return sr(t+"image extraction failed @ 2 ["+e.message+"]",e)}if(u={width:o.width,height:o.height},s=(l=o.data).length,f=[],g=d=0,1===r)for(f.length=s/4;d<s;)c=l[d],m=l[d+1],h=l[d+2],f[g]=c*le+m*se+h,d+=4,g+=1;else if(2===r)for(f.length=s/2;d<s;)c=l[d],m=l[d+1],h=l[d+2],b=l[d+3],f[g]=c*le+m*se+h,f[g+1]=b,d+=4,g+=2;else if(3===r)for(f.length=s/4*3;d<s;)c=l[d],m=l[d+1],h=l[d+2],f[g]=c,f[g+1]=m,f[g+2]=h,d+=4,g+=3;else for(f.length=s;d<s;)f[d]=l[d],f[d+=1]=l[d],f[d+=1]=l[d],f[d+=1]=l[d],d+=1;return u.pixelSize=r,u.data=f,u}(e,o))!==PS.ERROR)try{l.source=u,l.id=r,a(l)}catch(e){sr("[PS.imageLoad] .exec function failed ["+e.message+"]",e)}}function Vt(e,r){var t,n,i,a,o,u,l;if("object"!==Oe(r))return fr(e+"image argument not an object");if("number"!==Oe(t=r.width))return fr(e+"image.width not a number");if((t=Math.floor(t))<1)return fr(e+"image.width < 1");if(r.width=t,"number"!==Oe(n=r.height))return fr(e+"image.height not a number");if((n=Math.floor(n))<1)return fr(e+"image.height < 1");if(r.height=n,"number"!==Oe(i=r.pixelSize))return fr(e+"image.pixelSize not a number");if((i=Math.floor(i))<1&&4<i)return fr(e+"image.pixelSize is not 1, 2, 3 or 4");if(r.pixelSize=i,"array"!==Oe(a=r.data))return fr(e+"image.data is not an array");if((o=a.length)!==t*n*i)return fr(e+"image.data length invalid");for(u=0;u<o;u+=1){if("number"!==Oe(l=a[u]))return fr(e+"image.data["+u+"] not a number");if(l<0)return fr(e+"image.data["+u+"] negative");if(i<3){if(16777215<l)return fr(e+"image.data["+u+"] > 0xFFFFFF")}else if(255<l)return fr(e+"image.data["+u+"] > 255")}return!0}function Jt(e,r){var t,n;if(t=e.toString(16).toUpperCase(),r)for(n=t.length;n<r;)t="0"+t,n+=1;return"0x"+t}function Xt(){var e;return e={id:"sprite_"+Se,placed:!1,visible:!0,x:0,y:0,ax:0,ay:0,image:null,color:null,collide:null,width:0,height:0,plane:-1},Se+=1,O.push(e),e}function $t(e,r){var t,n,i;if("string"!=typeof e||e.length<1)return fr(r+"sprite argument invalid");for(t=O.length,n=0;n<t;n+=1)if((i=O[n]).id===e)return i;return fr(r+"sprite id '"+e+"' does not exist")}function Zt(e,r,t,n,i){var a,o,u,l,s,f,d,g;if(void 0===r&&(r=e.x,t=e.y,n=e.width,i=e.height),!((a=k.x)<=(r-=e.ax))){if(r<0){if((n+=r)<1)return;r=0}if(a<r+n&&(n=a-r),u=r+n,!((o=k.y)<=(t-=e.ay))){if(t<0){if((i+=t)<1)return;t=0}for(o<t+i&&(i=o-t),l=t+i,f=t;f<l;f+=1)for(s=r;s<u;s+=1)(d=B[s+f*a]).active&&((g=xr(d,e.plane)).r=255,g.g=255,g.b=255,g.a=0,g.rgb=16777215,Er(d))}}}function en(e){var r,t,n,i,a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E;if(r=e.width,t=e.height,!(r<1||t<1||(s=0,(n=k.x)<=(a=e.x-e.ax)))){if(a<0){if((r+=a)<1)return;a=0,s=e.width-r}if(n<a+r&&(r=n-a),u=a+r,f=0,!((i=k.y)<=(o=e.y-e.ay))){if(o<0){if((t+=o)<1)return;o=0,f=e.height-t}if(i<o+t&&(t=i-o),l=o+t,d=e.color)for(c=o;c<l;c+=1)for(g=a;g<u;g+=1)(m=B[g+c*n]).active&&((h=xr(m,e.plane)).rgb=d.rgb,h.r=d.r,h.g=d.g,h.b=d.b,h.a=d.a,Er(m));else for(b=e.image.data,c=o;c<l;c+=1){for(S=4*(f*e.width+s),g=a;g<u;g+=1)(m=B[g+c*n]).active&&(R=b[S],P=b[S+1],p=b[S+2],E=b[S+3],(h=xr(m,e.plane)).rgb=R*le+P*se+p,h.r=R,h.g=P,h.b=p,h.a=E,Er(m)),S+=4;f+=1}}}}function rn(e,r){var t,n,i,a,o,u,l,s,f,d,g,c,m,h,b,S,R,P;for(t="[_collisionCheck] ",a=e.x-e.ax,o=e.y-e.ay,u=e.width,l=e.height,s=e.collide,n=O.length,i=0;i<n;i+=1)if((d=(f=O[i]).id)!==r&&f.visible&&f.placed&&(g=f.x-f.ax,c=f.y-f.ay,m=f.width,h=f.height,b=f.collide,S=a<g?g-a:a-g,R=o<c?c-o:o-c,P=null,a===g-u||a===g+m?(o<=c&&R<=l||c<=o&&R<=h)&&(P=PS.SPRITE_TOUCH):o===c-l||o===c+h?(a<=g&&S<=u||g<=a&&S<=m)&&(P=PS.SPRITE_TOUCH):g<=a&&a<g+m?(o<=c&&R<l||c<=o&&R<h)&&(P=PS.SPRITE_OVERLAP):a<=g&&g<a+u&&(c<=o&&R<h||o<=c&&R<l)&&(P=PS.SPRITE_OVERLAP),P)){if(s)try{s(r,e.plane,d,f.plane,P)}catch(e){return void sr(t+r+" collide function failed ["+e.message+"]",e)}if(b)try{b(d,f.plane,r,e.plane,P)}catch(e){return void sr(t+d+" collide function failed ["+e.message+"]",e)}}}function tn(e){this.content=[],this.scoreFunction=e}function nn(e,r,t,n){var i,a;return(a=r<n?n-r:r-n)<(i=e<t?t-e:e-t)?a*fe+(i-a):i*fe+(a-i)}function an(e){return e.f}function on(e){var r,t,n;for(r=V.length,t=0;t<r;t+=1)if((n=V[t]).id===e)return n;return null}function un(e){w.inputP.style.display="none",w.statusNode.nodeValue=w.text=e,w.statusP.style.display="block"}function ln(e,r){var t;if((t=w.exec)&&"function"==typeof t)try{t(e)}catch(e){sr("PS.statusInput() callback failed ["+e.message+"]",e)}w.input.removeEventListener("keydown",r,!1),un(w.text),bt()}function sn(e){var r;return(r=e.which)||(r=e.keyCode),r===PS.KEY_ENTER?(ln(w.input.value,sn),Ie(e)):r!==PS.KEY_ESCAPE||(ln("",sn),Ie(e))}function fn(e,r){var t;w.statusP.style.display="none",(t=e).length<1&&(t=">"),w.label=t,w.inputNode.nodeValue=t,w.exec=r,w.input.value="",Ee&&(Ee=!1,document.removeEventListener("keydown",st,!1),document.removeEventListener("keyup",dt,!1)),w.input.addEventListener("keydown",sn,!1),w.inputP.style.display="block",w.input.focus()}tn.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e,r;return e=this.content[0],r=this.content.pop(),0<this.content.length&&(this.content[0]=r,this.sinkDown(0)),e},remove:function(e){var r,t,n;for(r=this.content.length,t=0;t<r;t+=1)if(this.content[t]===e){n=this.content.pop(),t!==r-1&&(this.content[t]=n,this.bubbleUp(t),this.sinkDown(t));break}},size:function(){return this.content.length},bubbleUp:function(e){var r,t,n,i;for(r=this.content[e],t=this.scoreFunction(r);0<e&&(n=Math.floor((e+1)/2)-1,i=this.content[n],!(t>=this.scoreFunction(i)));)this.content[n]=r,this.content[e]=i,e=n},sinkDown:function(e){var r,t,n,i,a,o,u,l,s;for(r=this.content.length,t=this.content[e],n=this.scoreFunction(t);o=null,(i=(a=2*(e+1))-1)<r&&(u=this.content[i],(l=this.scoreFunction(u))<n&&(o=i)),a<r&&(s=this.content[a],this.scoreFunction(s)<(null===o?n:l)&&(o=a)),null!==o;)this.content[e]=this.content[o],this.content[o]=t,e=o},rescore:function(e){this.sinkDown(this.content.indexOf(e))}};var dn=["January","February","March","April","May","June","July","August","September","October","November","December"],gn=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],cn=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],mn=["SUN","MON","TUE","WED","THU","FRI","SAT"];function hn(){var e,r,t,n,i,a,o,u;return(r={time:(e=new Date).getTime(),year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay(),hour24:e.getHours(),hour:0,minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds(),zone:e.getTimezoneOffset(),monthName:"",monthShort:"",dayName:"",dayShort:"",am_pm:"",monthStr:"",dayStr:"",minuteStr:"",secondStr:"",millisecondStr:"",timeStr:"",formal:"",abbrev:"",timestamp:""}).monthName=dn[r.month],r.monthShort=gn[r.month],r.dayName=cn[r.day],r.dayShort=mn[r.day],r.hour=r.hour24+1,11<r.hour24?(r.am_pm="PM",12<r.hour24&&(r.hour=r.hour24-12)):r.am_pm="AM",t=r.month<10?"0"+r.month:r.month.toString(),r.monthStr=t,n=r.date<10?"0"+r.date:r.date.toString(),r.dateStr=n,i=r.hour<10?"0"+r.hour:r.hour.toString(),r.hourStr=i,a=r.minute<10?"0"+r.minute:r.minute.toString(),r.minuteStr=a,o=r.second<10?"0"+r.second:r.second.toString(),r.secondStr=o,u=r.millisecond<10?"00"+r.millisecond:r.millisecond<100?"0"+r.millisecond:r.millisecond.toString(),r.millisecondStr=u,r.timeStr=i+":"+a+":"+o+"+"+u,r.formal=r.dayName+" "+n+" "+r.monthName+" "+r.year+" "+r.timeStr+" "+r.am_pm,r.abbrev=r.dayShort+" "+n+" "+r.monthShort+" "+r.year+" "+r.timeStr+" "+r.am_pm,r.timestamp=r.dayShort+"_"+n+"_"+r.monthShort+"_"+r.year+"_"+i+"_"+a+"_"+o+"_"+u+r.am_pm,r.hours24=r.hour24,r.hours=r.hour,r.minutes=r.minute,r.seconds=r.second,r.milliseconds=r.millisecond,r.string=r.abbrev,r}var bn={TIME_LABEL:"time",store:{},validID:function(e){return bn.store.hasOwnProperty(e)},expand:function(e){var r,t,n;return e-=36e5*(r=Math.floor(e/36e5)),e-=6e4*(t=Math.floor(e/6e4)),{h:r,m:t,s:n=Math.floor(e/1e3),ms:e-=1e3*n}},tstring:function(e,r){var t,n,i,a;return t=bn.expand(e),n="",0<r.h?(t.h<10&&(n+="0"),n+=t.h+":",t.m<10&&(n+="0"),n+=t.m+":",t.s<10&&(n+="0"),n+=t.s+"."):0<r.m?(t.m<10&&(n+="0"),n+=t.m+":",t.s<10&&(n+="0"),n+=t.s+"."):0<r.s&&(t.s<10&&(n+="0"),n+=t.s+"."),i="",t.ms<10?i+="00":t.ms<100&&(i+="0"),1===(a=(i+=t.ms.toString()).length)?i+="00":2===a&&(i+="0"),n+=i},csv:function(e,r){var t,n,i,a,o,u,l,s,f,d;if((n=(t=bn.store[r]).events.length)<1)return fr(e+"Database '"+r+"' is empty");for(i=t.fields.length,a=bn.expand(t.tmax),o=bn.TIME_LABEL+",",l=i-1,u=0;u<i;u+=1)o+=s=t.fields[u],u<l&&(o+=",");for(o+="\r\n",u=0;u<n;u+=1){for(f=t.events[u],o+=bn.tstring(f[bn.TIME_LABEL],a),o+=",",d=0;d<i;d+=1)s=t.fields[d],f.hasOwnProperty(s)&&(o+=f[s].toString()),d<l&&(o+=",");o+="\r\n"}return o},init:function(e,r,t){return bn.store[e]={name:e,date:hn(),fields:[],events:[],tmax:0,user:r,discard:t},t||(p<1&&window.addEventListener("beforeunload",Pt,!1),p+=1),e},erase:function(e){bn.store[e].discard||(p-=1)<1&&window.removeEventListener("beforeunload",Pt,!1),delete bn.store[e]},event:function(e,r){var t,n,i,a,o,u;for(t=bn.store[e],n=(new Date).getTime()-t.date.time,(i={})[bn.TIME_LABEL]=n,t.tmax=n,a=r.length,o=0;o<a;o+=2)u=r[o],t.fields.indexOf(u)<0&&t.fields.push(u),i[u]=r[o+1];return t.events.push(i),n},emails:function(r,t,e,n,i){var a,o,u,l,s,f;return a=bn.store[t],(o=bn.csv(r,t))===PS.ERROR?PS.ERROR:(u={id:t,timestamp:a.date.timestamp,csv:o,user:a.user||n,bcc:null},l=function(e){if(e.error)return fr(r,e.error);i&&((f=i.message)&&"string"==typeof f&&0<f.length&&Pr(f),i.discard&&bn.erase(t))},(s=K.PS.sendVerifiedEmails(e,u,l,Rt))!==K.OK?s:t)}};return{ALL:"PS.ALL",CURRENT:"PS.CURRENT",DONE:"PS.DONE",DEFAULT:"PS.DEFAULT",ERROR:"PS.ERROR",EMPTY:"PS.EMPTY",UNEQUAL:"PS.UNEQUAL",GRID:"PS.GRID",STATUS:"PS.STATUS",HTML5_AUDIO:"PS.HTML5_AUDIO",WEB_AUDIO:"PS.WEB_AUDIO",SPRITE_TOUCH:"PS.SPRITE_TOUCH",SPRITE_OVERLAP:"PS.SPRITE_OVERLAP",COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ALPHA_OPAQUE:255,ALPHA_TRANSPARENT:0,KEY_ENTER:13,KEY_TAB:9,KEY_ESCAPE:27,KEY_ARROW_LEFT:1005,KEY_ARROW_UP:1006,KEY_ARROW_RIGHT:1007,KEY_ARROW_DOWN:1008,KEY_DELETE:1010,KEY_PAD_0:96,KEY_PAD_1:97,KEY_PAD_2:98,KEY_PAD_3:99,KEY_PAD_4:100,KEY_PAD_5:101,KEY_PAD_6:102,KEY_PAD_7:103,KEY_PAD_8:104,KEY_PAD_9:105,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,WHEEL_FORWARD:"PS.WHEEL_FORWARD",WHEEL_BACKWARD:"PS.WHEEL_BACKWARD",FINDER_ASTAR:"PS.FINDER_ASTAR",FINDER_BREADTH_FIRST:"PS.FINDER_BREADTH_FIRST",FINDER_BEST_FIRST:"PS.FINDER_BEST_FIRST",FINDER_DIJKSTRA:"PS.FINDER_DIJKSTRA",FINDER_BI_ASTAR:"PS.FINDER_BI_ASTAR",FINDER_BI_BEST_FIRST:"PS.FINDER_BI_BEST_FIRST",FINDER_BI_DIJKSTRA:"PS.FINDER_BI_DIJKSTRA",FINDER_BI_BREADTH_FIRST:"PS.FINDER_BI_BREADTH_FIRST",FINDER_JUMP_POINT:"PS.FINDER_JUMP_POINT",_lastTick:0,_clock:function(){Re&&(window.requestAnimationFrame(PS._clock),function(){var r,e,t,n,i,a,o,u,l,s,f,d,g;if(_+=1,e=!(r="[_tick] "),De&&PAD&&(e=PAD.scan()),E<=(m+=1))for(m=0,t=c.length,n=0;n<t;)if(o=(i=c[n]).frames.length,i.kill)c.splice(n,1),t-=1;else if(i.active){if(a=i.frames[i.step],f=i.onStep){g=[o,i.step,a.rgb],i.params&&(g=g.concat(i.params));try{!1!==(s=f.apply(v,g))&&null!==s||(i.step=o-1,a=i.frames[i.step]),e=!0}catch(e){return sr(r+"fader .onStep failed ["+e.message+"]",e)}}if(i.exec)try{i.exec(a,i.element)}catch(e){return sr(r+"fader .exec failed ["+e.message+"]",e)}if(i.step+=1,i.step>=o){if(i.active=!1,i.step=0,i.frames.length=0,i.execEnd)try{i.execEnd(a,i.element)}catch(e){return sr(r+"fader .execEnd failed ["+e.message+"]",e)}if(f=i.onEnd){(g=i.params)||(g=[]);try{f.apply(v,g),e=!0}catch(e){return sr(r+"fader .onEnd failed ["+e.message+"]",e)}}c.splice(n,1),t-=1}else n+=1}else n+=1;if(t=j.length,ye&&0<t)if(0<h)h-=1;else if(h=G,PS.keyDown)for(n=0;n<t;n+=1)if(u=j[n]){Sr.time=_;try{PS.keyDown(u,ve,Te,Sr),e=!0}catch(e){return sr(r+"Key repeat failed ["+e.message+"]",e)}}if(0<(t=I.length))for(n=0;n<t;){if(d=(l=I[n]).id,l.count-=1,l.count<1){l.count=l.delay;try{s=l.exec.apply(v,l.arglist),e=!0}catch(e){s=sr(r+"Timed function failed ["+e.message+"]",e)}s===PS.ERROR&&PS.timerStop(d),t=I.length}0<t&&(l=I[n])&&l.id===d&&(n+=1)}e&&nr()}())},_sys:function(){var e,r,t,n,i,a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p;for("[PS.sys] ",(c=document.createElement("link")).setAttribute("rel","stylesheet"),c.setAttribute("href",de.font.file),he=Math.floor(1e6*Math.random())+1,(y=[]).length=256,(U=[]).length=256,(A=[]).length=256,(D=[]).length=256,e=0;e<256;e+=1)y[e]="rgba("+e+",",U[e]=e+",",A[e]=e+",1)",f=Math.floor(100*Math.max(0,Math.min(e/255,1)))/100,ce[e]=f,D[e]=f+")";if(function(){var e,r,t,n,i;if(e=window.navigator.userAgent.toLowerCase(),r=window.navigator.platform.toLowerCase(),/firefox/.test(e)?(t="Firefox",/fennec/.test(e)&&(t+=" Mobile"),i=/firefox\/[\.\d]+/.exec(e)[0].split("/")[1]):/chrome/.test(e)?(t="Chrome",i=/chrome\/[\d\.]+/.exec(e)[0].split("/")[1]):/safari/.test(e)?(t="Safari",(/iphone/.test(e)||/ipad/.test(e)||/ipod/.test(e))&&(n="iOS")):/msie/.test(e)?(t="Internet Explorer",/iemobile/.test(e)&&(t+=" Mobile"),i=/msie \d+[.]\d+/.exec(e)[0].split(" ")[1]):/trident/.test(e)?(t="Internet Explorer",i=/rv\:\d+[.]\d+/.exec(e)[0].split(":")[1]):/opera/.test(e)?(t="Opera",/mini/.test(e)?t+=" Mini":/mobile/.test(e)&&(t+=" Mobile")):/android/.test(e)&&(t="Android",n=/android\s[\.\d]+/.exec(e)),!i)try{i=(i=/version\/[\.\d]+/.exec(e))?i[0].split("/")[1]:/opera\/[\.\d]+/.exec(e)[0].split("/")[1]}catch(e){console.error("Problem detecting browser: "+e.message),i=""}"win32"===r||"win64"===r?n="Windows":"macintel"!==r&&"macppc"!==r||(n="Mac OS X ",n+=/10[\.\_\d]+/.exec(e)[0],/[\_]/.test(n)&&(n=n.split("_").join("."))),n||(/linux/.test(r)?n="Linux":/windows/.test(e)&&(n="Windows")),ge.host.app=t,i&&(ge.host.version=i),ge.host.os=n}(),x=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,C=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,640<=x&&640<=C?(S=ue,R=1.25,P=8,p=64):(h=x/5*4,b=C/5*4,S=Math.min(h,b),R=(S=8*Math.floor(S/8))/ue*1.25,R=Math.floor(100*R)/100,p=S/ue*64,p=Math.floor(p),P=Math.floor(p/8)),L=S,N=R+"em",de.grid.shadow.params="0px 0px "+p+"px "+P+"px ",Ue=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),ge.inputs.touch=Ue,document.body.id="body",document.body.style.backgroundColor=de.grid.color.str,(r=document.getElementById(J))||((r=document.createElement("div")).id=J,document.body.appendChild(r)),(me=document.getElementById(X))||((me=document.createElement("div")).id=X,r.appendChild(me)),me.style.width=L+"px",PS._mainLeft=me.offsetLeft,PS._mainTop=me.offsetTop,(t=document.getElementById($))||((t=document.createElement("p")).id=$,me.appendChild(t)),t.style.fontSize=N,n=document.createTextNode(""),t.appendChild(n),(i=document.getElementById("inp"))||((i=document.createElement("p")).id="inp",me.appendChild(i)),i.style.fontSize=N,(o=document.getElementById(Z))||((o=document.createElement("span")).id=Z,i.appendChild(o)),a=document.createTextNode(""),o.appendChild(a),(o=document.getElementById(ee))||((o=document.createElement("span")).id=ee,i.appendChild(o)),(u=document.getElementById(re))||((u=document.createElement("input")).id=re,o.appendChild(u)),u.tabindex=0,u.wrap="soft",w={statusP:t,statusNode:n,inputP:i,inputNode:a,input:u,colorNow:null,fader:cr($,Ve,null),text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},un("Perlenspiel "+ge.major+"."+ge.minor),!(l=document.getElementById(te))){if(!(l=document.createElement("canvas")))return void window.alert("[PS.sys] HTML5 canvas not supported.");l.id=te,me.appendChild(l)}for(l.width=L,l.style.backgroundColor=de.grid.color.str,Ae=!1,qr(),(pe=document.getElementById(ne))||((pe=document.createElement("p")).id=ne,me.appendChild(pe)),lr("Loading Perlenspiel"),(Le=document.getElementById(ie))||((Le=document.createElement("div")).id=ie,me.appendChild(Le)),(Ne=document.getElementById(ae))||((Ne=document.createElement("textarea")).id=ae,Le.appendChild(Ne)),Ne.rows=8,Ne.wrap="soft",Ne.readonly="readonly",Ne.onfocus=function(){Fe=!0},Ne.onblur=function(){Fe=!1},Ne.addEventListener("mousedown",Xr,!1),Ne.addEventListener("mouseup",$r,!1),Ee=Fe=we=!1,H=[],Y=[],z=[],W=[],e=0;e<256;e+=1)H[e]=0,Y[e]=e,z[e]=e,W[e]=e;for(ye=!(Te=ve=!(j=[])),G=6,q=30,Y[33]=PS.KEY_PAGE_UP,Y[34]=PS.KEY_PAGE_DOWN,Y[35]=PS.KEY_END,Y[36]=PS.KEY_HOME,Y[37]=PS.KEY_ARROW_LEFT,Y[38]=PS.KEY_ARROW_UP,Y[39]=PS.KEY_ARROW_RIGHT,Y[40]=PS.KEY_ARROW_DOWN,Y[45]=PS.KEY_INSERT,Y[46]=PS.KEY_DELETE,Y[188]=44,Y[190]=46,Y[191]=47,Y[192]=96,Y[219]=91,Y[220]=92,Y[221]=93,Y[222]=39,z[96]=126,z[49]=33,z[50]=64,z[51]=35,z[52]=36,z[53]=37,z[54]=94,z[55]=38,z[56]=42,z[57]=40,z[48]=41,z[45]=95,z[61]=43,z[91]=123,z[93]=125,z[92]=124,z[59]=58,z[39]=34,z[44]=60,z[46]=62,z[47]=63,e=65;e<91;e+=1)W[e]=e+32;W[126]=96,W[33]=49,W[64]=50,W[35]=51,W[36]=52,W[37]=53,W[94]=54,W[38]=55,W[42]=56,W[40]=57,W[41]=48,W[95]=45,W[43]=51,W[123]=91,W[125]=93,W[124]=92,W[58]=59,W[34]=39,W[60]=44,W[62]=46,W[63]=47,window.onblur=ot(),(s=l.getContext("2d")).constructor.prototype.fillRoundedRect||(s.constructor.prototype.fillRoundedRect=function(e,r,t,n,i,a,o){void 0===i&&(i=5),this.beginPath(),"Opera"===ge.host.app?(this.moveTo(e+t-i,r),this.arcTo(e+i,r,e,r+i,i),this.arcTo(e,r+n-i,e+i,r+n,i),this.arcTo(e+t-i,r+n,e+t,r+n-i,i),this.arcTo(e+t,r+i,e+t-i,r,i)):(this.moveTo(e+i,r),this.arcTo(e+t,r,e+t,r+n,i),this.arcTo(e+t,r+n,e,r+n,i),this.arcTo(e,r+n,e,r,i),this.arcTo(e,r,e+t,r,i)),this.closePath(),o?this.stroke():(a||void 0===a)&&this.fill()}),s.constructor.prototype.fillCircle||(s.constructor.prototype.fillCircle=function(e,r,t,n,i,a){var o;o=t/2,this.beginPath(),this.arc(e+o,r+o,o,0,2*Math.PI,!0),this.closePath(),a?this.stroke():(i||void 0===i)&&this.fill()}),k={canvas:l,context:s,colorNow:null,fader:cr(te,Ge,Qe),width:512,x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:!1,timeExit:0};var E,v,T=window.getComputedStyle(k.canvas,null);for(k.padLeft=parseInt(T.getPropertyValue("padding-top").replace("px",""),10),k.padRight=parseInt(T.getPropertyValue("padding-left").replace("px",""),10),(B=[]).length=f=1024,e=0;e<f;e+=1)d={index:E=e,dirty:!0,active:!0,visible:!0,radius:0,scale:0,minimum:de.bead.minimum,data:0,exec:null,colorNow:null,fader:cr(E,Je,Xe),color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},bgColor:{r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},border:{width:1,equal:!0,top:1,left:1,bottom:1,right:1,colorNow:null,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"},fader:cr(E,$e,Ze)},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,colorNow:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"},fader:cr(E,er,rr)},planes:[{height:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}}]},B[e]=d;if(O=[],V=[],Me=Se=0,g=null,"iOS"!==ge.host.os){if((g=AQ.init({defaultPath:de.audio.path,defaultFileTypes:["ogg","mp3","wav"],onAlert:PS.debug,stack:!0,forceHTML5:!0}))===PS.ERROR||g.status===AQ.ERROR)return;ge.audio=g,Q=null,(c=PS.audioLoad(de.audio.error_sound,{path:de.audio.path,lock:!0}))===PS.ERROR?ir("Error sound '"+de.audio.error_sound+"' not loaded"):Q=de.audio.error_sound}if((s=(F=document.createElement("canvas")).getContext("2d")).imageSmoothingEnabled=!1,s.webkitImageSmoothingEnabled=!1,M=[],be=0,m="() function invalid; will be ignored",PS.init&&"function"!=typeof PS.init&&(PS.init=null,ir("PS.init"+m)),PS.touch&&"function"!=typeof PS.touch&&(PS.touch=null,ir("PS.touch"+m)),PS.release&&"function"!=typeof PS.release&&(PS.release=null,ir("PS.release"+m)),PS.enter&&"function"!=typeof PS.enter&&(PS.enter=null,ir("PS.enter"+m)),PS.exit&&"function"!=typeof PS.exit&&(PS.exit=null,ir("PS.exit"+m)),PS.exitGrid&&"function"!=typeof PS.exitGrid&&(PS.exitGrid=null,ir("PS.exitGrid"+m)),PS.keyDown&&"function"!=typeof PS.keyDown&&(PS.keyDown=null,ir("PS.keyDown"+m)),PS.keyUp&&"function"!=typeof PS.keyUp&&(PS.keyUp=null,ir("PS.keyUp"+m)),PS.input&&"function"!=typeof PS.input&&(PS.input=null,ir("PS.input"+m)),PS.swipe&&"function"!=typeof PS.swipe&&(PS.swipe=null,ir("PS.swipe"+m)),PS.shutdown&&"function"!=typeof PS.shutdown&&(PS.shutdown=null,ir("PS.shutdown"+m)),vt(de.grid.x,de.grid.y),dr(),I=[],Pe=0,PAD&&(ge.inputs.gamepad=De=PAD.init(function(e){xe.gamepad=e,Ce.time=_,gt(xe,Ce)})),Re=!0,_=0,PS._clock(),m="PS "+ge.major+"."+ge.minor+"."+ge.revision+" | ",g&&(m+=g.engine+" "+g.major+"."+g.minor+"."+g.revision+" | "),K&&(c=K.PS.init())&&(m+=c.name+" "+c.major+"."+c.minor+"."+c.revision+" | "),m+=ge.host.os+" "+ge.host.app+" "+ge.host.version,Ue&&(m+=" | Touch "),Pr(m),(v=k.canvas).style.display="block",qr(),document.addEventListener("mousedown",Vr,!1),document.addEventListener("mouseup",Jr,!1),v.addEventListener("mousedown",Zr,!1),v.addEventListener("mouseup",et,!1),v.addEventListener("mousemove",rt,!1),v.addEventListener("mouseout",tt,!1),bt(),window.addEventListener("DOMMouseScroll",ht,!1),window.addEventListener("mousewheel",ht,!1),Ue&&(document.addEventListener("touchmove",at,!1),document.addEventListener("touchstart",nt,!1),document.addEventListener("touchend",it,!1),document.addEventListener("touchcancel",it,!1)),PS.init){ge.date=hn();try{PS.init(ge,{time:_}),nr()}catch(e){sr("PS.init() failed ["+e.message+"]",e)}}},gridSize:function(e,r){var t,n,i,a,o;if(t="[PS.gridSize] ",0<(n=arguments.length)){if(2<n)return fr(t+"Too many arguments");if(i=e,a=r,o=de.grid.max,i===PS.DEFAULT)i=de.grid.x;else if(i===PS.CURRENT)i=k.x;else{if("number"!==Oe(i))return fr(t+"x argument invalid");(i=Math.floor(i))<1?i=1:o<i&&(i=o)}if(a===PS.DEFAULT)a=de.grid.y;else if(a===PS.CURRENT)a=k.y;else{if("number"!==Oe(a))return fr(t+"y argument invalid");(a=Math.floor(a))<1?a=1:o<a&&(a=o)}vt(i,a)}return{width:k.x,height:k.y}},gridPlane:function(e){var r,t,n;if(r="[PS.gridPlane] ",1<arguments.length)return fr(r+"Too many arguments");if("undefined"!==(n=Oe(t=e))&&t!==PS.CURRENT){if(t===PS.DEFAULT)t=0;else{if("number"!==n)return fr(r+"plane argument invalid");(t=Math.floor(t))<1&&(t=0)}k.plane=t}return k.plane},gridColor:function(e,r,t){var n,i;return n="[PS.gridColor] ",3<arguments.length?fr(n+"Too many arguments"):(i=Ur(n,e,r,t))===PS.ERROR?PS.ERROR:pt(i)},gridFade:function(e,r){var t,n,i,a,o,u,l,s;if(t="[PS.gridFade] ",2<arguments.length)return fr(t+"Too many arguments");if(i=k.color,a=(n=k.fader).rate,"undefined"===(l=Oe(e))||e===PS.CURRENT)o=a;else if(e===PS.DEFAULT)o=de.fader.rate;else{if("number"!==l)return fr(t+"rate argument invalid");(o=Math.floor(e))<0&&(o=0)}return(u=xt(t,r))===PS.ERROR?PS.ERROR:((s=u.rgb)!==PS.CURRENT&&(s===PS.DEFAULT?n.rgb=de.fader.rgb:n.rgb=s,n.r=u.r,n.g=u.g,n.b=u.b),(s=u.onStep)!==PS.CURRENT&&(s===PS.DEFAULT?n.onStep=de.fader.onStep:n.onStep=s),(s=u.onEnd)!==PS.CURRENT&&(s===PS.DEFAULT?n.onEnd=de.fader.onEnd:n.onEnd=s),(s=u.params)!==PS.CURRENT&&(s===PS.DEFAULT?n.params=de.fader.params:n.params=s),a!==o&&((n.rate=o)<1?(n.active=!1,n.kill=!0):n.active&&br(n,i.r,i.g,i.b,255)),{rate:n.rate,rgb:n.rgb,onStep:n.onStep,onEnd:n.onEnd,params:n.params})},gridShadow:function(e,r,t,n){var i,a,o;if(i="[PS.gridShadow] ",4<arguments.length)return fr(i+"Too many arguments");if(!0!==(a=e)&&!1!==a&&a!==PS.CURRENT)if(null===a||a===PS.DEFAULT)a=!1;else{if("number"!==Oe(a))return fr(i+"First argument invalid");a=0!==a}return(o=Ur(i,r,t,n))===PS.ERROR?PS.ERROR:Et(a,o)},gridRefresh:function(){return"[PS.gridRefresh] ",0<arguments.length?fr("[PS.gridRefresh] Too many arguments"):(nr(),i)},color:function(e,r,t,n,i){var a,o,u;return a="[PS.color] ",(o=arguments.length)<2?fr(a+"Missing argument(s)"):5<o?fr(a+"Too many arguments"):(u=Ur(a,t,n,i))===PS.ERROR?PS.ERROR:Ut(a,At,e,r,u)},alpha:function(e,r,t){var n,i,a,o;if(n="[PS.alpha] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if("number"===o)(a=Math.floor(a))<0?a=0:255<a&&(a=255);else{if(a!==PS.DEFAULT)return fr(n+"alpha argument invalid");a=de.bead.color.a}return Ut(n,Dt,e,r,a)},fade:function(e,r,t,n){var i,a,o,u,l;if(i="[PS.fade] ",(a=arguments.length)<2)return fr(i+"Missing argument(s)");if(4<a)return fr(i+"Too many arguments");if((o=t)!==PS.CURRENT&&o!==PS.DEFAULT)if("undefined"===(u=Oe(o)))o=PS.CURRENT;else{if("number"!==u)return fr(i+"rate argument invalid");(o=Math.floor(o))<0&&(o=0)}return(l=xt(i,n))===PS.ERROR?PS.ERROR:Ut(i,Ct,e,r,o,l)},scale:function(e,r,t){var n,i,a,o;if(n="[PS.scale] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if(a===PS.DEFAULT)a=100;else{if("number"!==o)return fr(n+"scale parameter invalid");(a=Math.floor(a))<50?a=50:100<a&&(a=100)}return Ut(n,Lt,e,r,a)},radius:function(e,r,t){var n,i,a,o;if(n="[PS.radius] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if(a===PS.DEFAULT)a=0;else{if("number"!==o)return fr(n+"radius parameter invalid");(a=Math.floor(a))<0?a=0:50<a&&(a=50)}return Ut(n,Nt,e,r,a)},bgColor:function(e,r,t,n,i){var a,o,u;return a="[PS.bgColor] ",(o=arguments.length)<2?fr(a+"Missing argument(s)"):5<o?fr(a+"Too many arguments"):(u=Ur(a,t,n,i))===PS.ERROR?PS.ERROR:Ut(a,wt,e,r,u)},bgAlpha:function(e,r,t){var n,i,a,o;if(n="[PS.bgAlpha] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if("number"===o)(a=Math.floor(a))<0?a=0:255<a&&(a=255);else{if(a!==PS.DEFAULT)return fr(n+"alpha argument invalid");a=de.bead.bgColor.a}return Ut(n,Ft,e,r,a)},data:function(e,r,t){var n,i,a;return n="[PS.data] ",(i=arguments.length)<2?fr(n+"Missing argument(s)"):3<i?fr(n+"Too many arguments"):(void 0===(a=t)?a=PS.CURRENT:a===PS.DEFAULT&&(a=null),Ut(n,Mt,e,r,a))},exec:function(e,r,t){var n,i,a,o;if(n="[PS.exec] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if(a===PS.DEFAULT)a=de.bead.exec;else if("function"!==o)return fr(n+"exec argument invalid");return Ut(n,Ot,e,r,a)},visible:function(e,r,t){var n,i,a;return n="[PS.visible] ",(i=arguments.length)<2?fr(n+"Missing argument(s)"):3<i?fr(n+"Too many arguments"):(a=_e(t,PS.CURRENT,!0,PS.CURRENT))===PS.ERROR?fr(n+"show argument invalid"):Ut(n,_t,e,r,a)},active:function(e,r,t){var n,i,a;return n="[PS.active] ",(i=arguments.length)<2?fr(n+"Missing argument(s)"):3<i?fr(n+"Too many arguments"):(a=_e(t,PS.CURRENT,!0,PS.CURRENT))===PS.ERROR?fr(n+"active argument invalid"):Ut(n,It,e,r,a)},minimum:function(e,r,t){var n,i,a;if(n="[PS.minimum] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if(void 0===a)a=PS.CURRENT;else if(a===PS.DEFAULT)a=de.bead.minimum;else{if("number"!==Oe(a))return fr(n+"minimum argument invalid");(a=Math.floor(a))<0?a=0:ue<a&&(a=ue)}return Ut(n,kt,e,r,a)},border:function(e,r,t){var n,i,a,o,u,l;if(n="[PS.border] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if(a=de.bead.border,(o=t)!==PS.CURRENT)if("undefined"===(u=Oe(o)))o=PS.CURRENT;else if(o===PS.DEFAULT)o=a.width;else if("number"===u)(o=Math.floor(o))<0&&(o=0);else{if("object"!==u)return fr(n+"width argument invalid");if((l=o.top)!==PS.CURRENT)if("undefined"===(u=Oe(l)))o.top=PS.CURRENT;else if("number"===u)(l=Math.floor(l))<0&&(l=0),o.top=l;else{if(l!==PS.DEFAULT)return fr(n+".top property invalid");o.top=a.top}if((l=o.left)!==PS.CURRENT)if("undefined"===(u=Oe(l)))o.left=PS.CURRENT;else if("number"===u)(l=Math.floor(l))<0&&(l=0),o.left=l;else{if(l!==PS.DEFAULT)return fr(n+".left property invalid");o.left=a.left}if((l=o.bottom)!==PS.CURRENT)if("undefined"===(u=Oe(l)))o.bottom=PS.CURRENT;else if("number"===u)(l=Math.floor(l))<0&&(l=0),o.bottom=l;else{if(l!==PS.DEFAULT)return fr(n+".bottom property invalid");o.bottom=a.bottom}if((l=o.right)!==PS.CURRENT)if("undefined"===(u=Oe(l)))o.right=PS.CURRENT;else if("number"===u)(l=Math.floor(l))<0&&(l=0),o.right=l;else{if(l!==PS.DEFAULT)return fr(n+".right property invalid");o.right=a.right}}return Ut(n,Kt,e,r,o)},borderColor:function(e,r,t,n,i){var a,o;return a="[PS.borderColor] ",arguments.length<2?fr(a+"Missing argument(s)"):5<arguments.length?fr(a+"Too many arguments"):(o=Ur(a,t,n,i))===PS.ERROR?PS.ERROR:Ut(a,Bt,e,r,o)},borderAlpha:function(e,r,t){var n,i,a,o;if(n="[PS.borderAlpha] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if("number"===o)(a=Math.floor(a))<0?a=0:255<a&&(a=255);else{if(a!==PS.DEFAULT)return fr(n+"alpha argument invalid");a=de.bead.border.color.a}return Ut(n,Yt,e,r,a)},borderFade:function(e,r,t,n){var i,a,o,u,l;if(i="[PS.borderFade] ",(a=arguments.length)<2)return fr(i+"Missing argument(s)");if(4<a)return fr(i+"Too many arguments");if((o=t)!==PS.CURRENT&&o!==PS.DEFAULT)if("undefined"===(u=Oe(o)))o=PS.CURRENT;else{if("number"!==u)return fr(i+"rate argument not a number");(o=Math.floor(o))<0&&(o=0)}return(l=xt(i,n))===PS.ERROR?PS.ERROR:Ut(i,zt,e,r,o,l)},glyph:function(e,r,t){var n,i,a,o,u;if(n="[PS.glyph] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if(void 0===(a=t))a=PS.CURRENT;else if(a===PS.DEFAULT)a="";else if(a!==PS.CURRENT)if("number"===(o=Oe(a)))if((a=Math.floor(a))<1)a="";else{if(1114111<a)return fr(n+"glyph argument exceeds Unicode limit");a=String.fromCodePoint(a)}else{if("string"!==o)return fr(n+"glyph argument invalid");0<a.length&&(92===(u=a.charCodeAt(0))?0<(a=decodeURI(a)).length&&(u=a.charCodeAt(0),a=String.fromCodePoint(u)):a=String.fromCodePoint(u))}return Ut(n,Wt,e,r,a)},glyphColor:function(e,r,t,n,i){var a,o;return a="[PS.glyphColor] ",arguments.length<2?fr(a+"Missing argument(s)"):5<arguments.length?fr(a+"Too many arguments"):(o=Ur(a,t,n,i))===PS.ERROR?PS.ERROR:Ut(a,Ht,e,r,o)},glyphAlpha:function(e,r,t){var n,i,a,o;if(n="[PS.glyphAlpha] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if("number"===o)(a=Math.floor(a))<0?a=0:255<a&&(a=255);else{if(a!==PS.DEFAULT)return fr(n+"alpha argument invalid");a=de.bead.glyph.color.a}return Ut(n,jt,e,r,a)},glyphScale:function(e,r,t){var n,i,a,o;if(n="[PS.glyphScale] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if((a=t)!==PS.CURRENT)if("undefined"===(o=Oe(a)))a=PS.CURRENT;else if("number"===o)(a=Math.floor(a))<50?a=50:100<a&&(a=100);else{if(a!==PS.DEFAULT)return fr(n+"scale argument invalid");a=de.bead.glyph.scale}return Ut(n,Gt,e,r,a)},glyphFade:function(e,r,t,n){var i,a,o,u,l;if(i="[PS.glyphFade] ",(a=arguments.length)<2)return fr(i+"Missing argument(s)");if(4<a)return fr(i+"Too many arguments");if((o=t)!==PS.CURRENT&&o!==PS.DEFAULT)if("undefined"===(u=Oe(o)))o=PS.CURRENT;else{if("number"!==u)return fr(i+"rate argument not a number");(o=Math.floor(o))<0&&(o=0)}return(l=xt(i,n))===PS.ERROR?PS.ERROR:Ut(i,qt,e,r,o,l)},statusText:function(e){var r,t;return"[PS.statusText] ",1<arguments.length?fr("[PS.statusText] Too many arguments"):(t=Oe(r=e),r!==PS.CURRENT&&"undefined"!==t&&(r===PS.DEFAULT?r=de.status.text:"string"!==t&&(r=r.toString()),un(r)),w.text)},statusInput:function(e,r){var t,n;return t="[PS.statusInput] ",2!==arguments.length?fr(t+"Expected 2 arguments"):r&&"function"==typeof r?(n=e.toString(),16<e.length&&(n=n.substring(0,16)),fn(n,r),w.label):fr(t+"function argument invalid")},statusColor:function(e,r,t){var n,i,a,o,u,l,s,f,d;return n="[PS.statusColor] ",3<arguments.length?fr(n+"Too many arguments"):(i=Ur(n,e,r,t))===PS.ERROR?PS.ERROR:(a=w.color,o=de.status.color,u=w.fader,(l=i.rgb)!==PS.CURRENT&&(null===l?((s=i.r)===PS.CURRENT?i.r=s=a.r:s===PS.DEFAULT&&(i.r=s=o.r),(f=i.g)===PS.CURRENT?i.g=f=a.g:f===PS.DEFAULT&&(i.g=f=o.g),(d=i.b)===PS.CURRENT?i.b=d=a.b:d===PS.DEFAULT&&(i.b=d=o.b),i.rgb=s*le+f*se+d):l===PS.DEFAULT&&(i={r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}),(a.rgb!==i.rgb||0<u.rate&&null!==u.rgb&&u.rgb!==i.rgb)&&(a.rgb=i.rgb,s=i.r,f=i.g,d=i.b,a.str=i.str=y[s]+U[f]+A[d],0<u.rate?(null!==u.rgb&&hr(u,u.r,u.g,u.b,255,s,f,d,255),u.active?br(u,s,f,d,255):hr(u,a.r,a.g,a.b,255,s,f,d,255)):Ve(a),a.r=s,a.g=f,a.b=d)),a.rgb)},statusFade:function(e,r){var t,n,i,a,o,u,l,s;if(t="[PS.statusFade] ",2<arguments.length)return fr(t+"Too many arguments");if(i=w.color,a=(n=w.fader).rate,"undefined"===(u=Oe(e))||e===PS.CURRENT)o=a;else if(e===PS.DEFAULT)o=de.fader.rate;else{if("number"!==u)return fr(t+"rate argument invalid");(o=Math.floor(e))<0&&(o=0)}return(s=xt(t,r))===PS.ERROR?PS.ERROR:((l=s.rgb)!==PS.CURRENT&&(l===PS.DEFAULT?n.rgb=de.fader.rgb:n.rgb=l,n.r=s.r,n.g=s.g,n.b=s.b),(l=s.onStep)!==PS.CURRENT&&(l===PS.DEFAULT?n.onStep=de.fader.onStep:n.onStep=l),(l=s.onEnd)!==PS.CURRENT&&(l===PS.DEFAULT?n.onEnd=de.fader.onEnd:n.onEnd=l),(l=s.params)!==PS.CURRENT&&(l===PS.DEFAULT?n.params=de.fader.params:n.params=l),a!==o&&((n.rate=o)<1?(n.active=!1,n.kill=!0):n.active&&br(n,i.r,i.g,i.b,255)),{rate:n.rate,rgb:n.rgb,onStep:n.onStep,onEnd:n.onEnd,params:n.params})},_footerFade:function(e){Pr(e)},timerStart:function(e,r){var t,n,i,a,o,u,l,s,f;if(t="[PS.timerStart] ",(n=arguments.length)<2)return fr(t+"Argument(s) missing");if(a=r,(i=e)===PS.DEFAULT)i=60;else{if("number"!==Oe(i))return fr(t+"ticks argument invalid");if((i=Math.floor(i))<1)return fr(t+"ticks argument less than one (1)")}if("function"!=typeof a)return fr(t+"exec argument not a function");if(u=[],2<n)for(s=n-2,u.length=s,l=0;l<s;l+=1)u[l]=arguments[l+2];return f="timer_"+Pe,Pe+=1,o={id:f,delay:i,count:i,exec:a,arglist:u},I.push(o),f},timerStop:function(e){var r,t,n;if(r="[PS.timerStop] ",arguments.length<1)return fr(r+"Argument missing");if(!e||"string"!=typeof e||e.length<1)return fr(r+"id argument invalid");for(n=I.length,t=0;t<n;t+=1)if(I[t].id===e)return I.splice(t,1),e;return fr(r+"timer id '"+e+"' not found")},random:function(e){var r,t;return r="[PS.random] ",arguments.length<1?fr(r+"Argument missing"):"number"!==Oe(t=e)?fr(r+"Argument not a number"):(t=Math.floor(t))<2?1:(t=function(){var e;return e=1e4*Math.sin(he),he+=1,e-Math.floor(e)}()*t,t=Math.floor(t)+1)},seed:function(e){var r,t;return r="[PS.seed] ",arguments.length<1?fr(r+"Argument missing"):"number"!==Oe(t=e)?fr(r+"Argument not a number"):((t=Math.floor(t))<1&&(t=1),he=t)},makeRGB:function(e,r,t){var n,i,a,o,u;return n="[PS.makeRGB] ",(i=arguments.length)<3?fr(n+"Argument(s) missing"):3<i?fr(n+"Too many arguments"):(o=r,u=t,"number"!==Oe(a=e)?fr(n+"r argument not a number"):((a=Math.floor(a))<0?a=0:255<a&&(a=255),"number"!==Oe(o)?fr(n+"g argument not a number"):((o=Math.floor(o))<0?o=0:255<o&&(o=255),"number"!==Oe(u)?fr(n+"b argument not a number"):((u=Math.floor(u))<0?u=0:255<u&&(u=255),a*le+o*se+u))))},unmakeRGB:function(e,r){var t,n,i,a,o,u,l,s,f;if(t="[PS.unmakeRGB] ",(n=arguments.length)<2)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many arguments");if(a=r,"number"!==Oe(i=e))return fr(t+"rgb argument not a number");if((i=Math.floor(i))<1?l=u=o=i=0:16777215<=i?(i=16777215,l=u=o=255):(o=i/le,u=(i-(s=(o=Math.floor(o))*le))/se,l=i-s-(u=Math.floor(u))*se),"object"===(f=Oe(a)))a.rgb=i,a.r=o,a.g=u,a.b=l;else{if("array"!==f)return fr(t+"result argument not an array or object reference");a.length<3&&(a.length=3),a[0]=o,a[1]=u,a[2]=l}return a},applyRect:function(e,r,t,n,i){var a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E;if(a="[PS.applyRect] ",(o=arguments.length)<5)return fr(a+"Argument(s) missing");if(u=k.x,l=k.y,f=r,d=t,g=n,c=i,(s=e)===PS.DEFAULT)s=0;else{if("number"!==Oe(s))return fr(a+"left argument invalid");if(u<=(s=Math.floor(s)))return PS.DONE;s<0&&(s=0)}if(f===PS.DEFAULT)f=0;else{if("number"!==Oe(f))return fr(a+"top argument invalid");if(l<=(f=Math.floor(f)))return PS.DONE;f<0&&(f=0)}if(d===PS.DEFAULT)d=u-s;else{if("number"!==Oe(d))return fr(a+"width argument invalid");if((d=Math.floor(d))<1)return PS.DONE;u<s+d&&(d=u-s)}if(m=s+d,g===PS.DEFAULT)g=l-f;else{if("number"!==Oe(g))return fr(a+"height argument invalid");if((g=Math.floor(g))<1)return PS.DONE;l<f+g&&(g=l-f)}if(h=f+g,!c||"function"!=typeof c)return fr(a+"exec argument not a function");if(P=[0,0],5<o)for(p=o-5,E=0;E<p;E+=1)P.push(arguments[E+5]);for(S=f;S<h;S+=1)for(P[1]=S,b=s;b<m;b+=1){P[0]=b;try{R=c.apply(v,P)}catch(e){R=sr(a+"exec failed @"+b+", "+S+" ["+e.message+"]",e)}if(R===PS.ERROR)return PS.ERROR}return R},hex:function(e,r){var t,n,i,a;if(t="[PS.hex] ","number"!==(i=Oe(n=e)))return fr(t+"value argument invalid");if(n=Math.floor(n),n=Math.abs(n),"undefined"===(i=Oe(a=r))||a===PS.DEFAULT)a=2;else{if("number"!==i)return fr(t+"padding argument invalid");(a=Math.floor(a))<1&&(a=1)}return Jt(n,a)},keyRepeat:function(e,r,t){var n,i,a,o,u;if(n="[PS.keyRepeat] ",(a=_e(e,ye,!0,!0))===PS.ERROR)return fr(n+"repeat argument invalid");if("undefined"===(i=Oe(u=r))||u===PS.DEFAULT)u=30;else if(u===PS.CURRENT)u=q;else{if("number"!==i)return fr(n+"init argument invalid");(u=Math.floor(u))<1&&(u=1)}if("undefined"===(i=Oe(o=t))||o===PS.DEFAULT)o=6;else if(o===PS.CURRENT)o=G;else{if("number"!==i)return fr(n+"delay argument invalid");(o=Math.floor(o))<1&&(o=1)}return{repeat:ye=a,init:q=u,delay:G=o}},date:function(){return hn()},elapsed:function(){return(new Date).getTime()-ge.date.time},imageLoad:function(e,r,t){var n,i,a,o,u,l,s,f,d;if(n="[PS.imageLoad] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many argument(s)");if(o=r,u=t,"string"!=typeof(a=e)||a.length<1)return fr(n+"filename argument invalid");if("png"!==(l=(l=a.substr(a.lastIndexOf(".")+1)).toLowerCase())&&"jpg"!==l&&"jpeg"!==l&&"bmp"!==l)return fr(n+"filename extension invalid");if("function"!=typeof o)return fr(n+"exec argument invalid");if("undefined"===(d=Oe(u))||u===PS.DEFAULT)u=4;else{if("number"!==d)return fr(n+"format argument invalid");if((u=Math.floor(u))<1&&4<u)return fr(n+"format argument is not 1, 2, 3 or 4")}f=oe+be,be+=1,M.push({source:a,id:f,exec:o,format:u});try{(s=new Image).setAttribute("data-id",f),s.onload=function(){Qt(s)},s.onerror=function(){!function(e){var r,t,n,i,a;for(r=e.getAttribute("data-id"),t=M.length,n=0;n<t;n+=1)if((i=M[n]).id===r){a=i.exec,M.splice(n,1);break}try{a(PS.ERROR)}catch(e){sr("[PS.imageLoad] .exec function failed ["+e.message+"]",e)}fr("[PS.imageLoad] Error loading "+e.src)}(s)},s.src=a}catch(e){return sr(n+"Error loading "+a+" ["+e.message+"]",e)}return f},imageBlit:function(e,r,t,n){var i,a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E,v,T,y,U,A,D,x,C,L,N,w,F,M,O,_,I;if(i="[PS.imageBlit] ",(a=arguments.length)<3)return fr(i+"Missing argument(s)");if(4<a)return fr(i+"Too many arguments");if(o=k.x,u=k.y,s=r,f=t,d=n,Vt(i,l=e)===PS.ERROR)return PS.ERROR;if(g=l.width,c=l.height,m=l.pixelSize,h=l.data,"undefined"===(b=Oe(s))||s===PS.DEFAULT)s=0;else{if("number"!==b)return fr(i+"xpos argument invalid");s=Math.floor(s)}if("undefined"===(b=Oe(f))||f===PS.DEFAULT)f=0;else{if("number"!==b)return fr(i+"ypos argument invalid");f=Math.floor(f)}if(o<=s||u<=f||s+g<1||f+c<1)return!1;if("undefined"===(b=Oe(d))||d===PS.DEFAULT)R=S=0,P=g,p=c;else{if("object"!==b)return fr(i+"region argument invalid");if("undefined"===(b=Oe(R=d.left))||R===PS.DEFAULT)R=0;else{if("number"!==b)return fr(i+"region.left invalid");if((R=Math.floor(R))<0)R=0;else if(g<=R)return fr(i+"region.left outside image")}if("undefined"===(b=Oe(S=d.top))||S===PS.DEFAULT)S=0;else{if("number"!==b)return fr(i+"region.top invalid");if((S=Math.floor(S))<0)S=0;else if(c<=S)return fr(i+"region.top outside image")}if("undefined"===(b=Oe(P=d.width))||P===PS.DEFAULT)P=g-R;else{if("number"!==b)return fr(i+"region.width invalid");if((P=Math.floor(P))<1)return!1;g<R+P&&(P=g-R)}if(s+P<1)return!1;if("undefined"===(b=Oe(p=d.height))||p===PS.DEFAULT)p=c-S;else{if("number"!==b)return fr(i+"region.height invalid");if((p=Math.floor(p))<1)return!1;c<S+p&&(p=c-S)}if(f+p<1)return!1}if(s<0){if((P+=s)<1)return!1;R-=s,s=0}if(o<s+P&&(P=o-s),P<1)return!1;if(f<0){if((p+=f)<1)return!1;S-=f,f=0}if(u<f+p&&(p=u-f),p<1)return!1;for(v=g*m,I=!1,w=255,E=k.plane,T=S*v+R*m,A=f,D=0;D<p;D+=1){for(y=T,U=s,x=0;x<P;x+=1)(O=B[U+A*o]).active&&(I=!0,m<3?(C=(F=h[y])/le,L=(F-(M=(C=Math.floor(C))*le))/se,N=F-M-(L=Math.floor(L))*se,2===m&&(w=h[y+1])):(C=h[y],L=h[y+1],N=h[y+2],F=C*le+L*se+N,4===m&&(w=h[y+3])),(_=xr(O,E)).r=C,_.g=L,_.b=N,_.a=w,_.rgb=F,Er(O)),U+=1,y+=m;A+=1,T+=v}return I&&nr(),!0},imageCapture:function(e,r){var t,n,i,a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E;if(t="[PS.imageCapture] ",2<arguments.length)return fr(t+"Too many arguments");if(i=r,"undefined"===(a=Oe(n=e))||n===PS.DEFAULT)n=3;else{if("number"!==a)return fr(t+"format argument invalid");if((n=Math.floor(n))<1&&4<n)return fr(t+"format argument is not 1, 2, 3 or 4")}if(o=k.x,u=k.y,"undefined"===(a=Oe(i))||i===PS.DEFAULT)f=s=0,d=o,g=u;else{if("object"!==a)return fr(t+"region argument invalid");if("undefined"===(a=Oe(f=i.left))||f===PS.DEFAULT)f=0;else{if("number"!==a)return fr(t+"region.left not a number");if((f=Math.floor(f))<0)f=0;else if(o<=f)return fr(t+"region.left outside grid")}if("undefined"===(a=Oe(s=i.top))||s===PS.DEFAULT)s=0;else{if("number"!==a)return fr(t+"region.top not a number");if((s=Math.floor(s))<0)s=0;else if(u<=s)return fr(t+"region.top outside grid")}if("undefined"===(a=Oe(d=i.width))||d===PS.DEFAULT)d=o-f;else{if("number"!==a)return fr(t+"region.width not a number");((d=Math.floor(d))<1||o<f+d)&&(d=o-f)}if("undefined"===(a=Oe(g=i.height))||g===PS.DEFAULT)g=u-s;else{if("number"!==a)return fr(t+"region.height not a number");((g=Math.floor(g))<1||u<s+g)&&(g=u-s)}}if(S=oe+be,be+=1,m={source:PS.GRID,id:S,width:d,height:g,pixelSize:n,valid:!0,data:[]},(c=d*g)<1)return m;for((l=m.data).length=c*n,h=f+d,b=s+g,R=0,p=s;p<b;p+=1)for(P=f;P<h;P+=1)E=B[P+p*o].color,n<3?(l[R]=E.rgb,2===n&&(l[R+1]=E.a)):(l[R]=E.r,l[R+1]=E.g,l[R+2]=E.b,4===n&&(l[R+3]=E.a)),R+=n;return m},imageDump:function(e,r,t,n,i){var a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E,v,T,y,U,A,D,x,C,L,N,w,F,M,O,_,I,k,K,B,Y,z,W;if(a="[PS.imageDump] ",(o=arguments.length)<1)return fr(a+"Missing argument(s)");if(5<o)return fr(a+"Too many arguments");if(l=r,s=t,f=n,Vt(a,u=e)===PS.ERROR)return PS.ERROR;if(g=u.width,c=u.height,m=u.pixelSize,h=u.data,"undefined"===(b=Oe(l))||l===PS.DEFAULT)R=S=0,P=g,p=c;else{if("object"!==b)return fr(a+"region argument invalid");if("undefined"===(b=Oe(R=l.left))||R===PS.DEFAULT)R=0;else{if("number"!==b)return fr(a+"region.left invalid");if((R=Math.floor(R))<0)R=0;else if(g<=R)return fr(a+"region.left outside grid")}if("undefined"===(b=Oe(S=l.top))||S===PS.DEFAULT)S=0;else{if("number"!==b)return fr(a+"region.top invalid");if((S=Math.floor(S))<0)S=0;else if(c<=S)return fr(a+"region.top outside grid")}if("undefined"===(b=Oe(P=l.width))||P===PS.DEFAULT)P=g-R;else{if("number"!==b)return fr(a+"region.width invalid");((P=Math.floor(P))<1||g<R+P)&&(P=g-R)}if("undefined"===(b=Oe(p=l.height))||p===PS.DEFAULT)p=c-S;else{if("number"!==b)return fr(a+"region.height invalid");((p=Math.floor(p))<1||c<S+p)&&(p=c-S)}}if(E=P*p,"undefined"===(b=Oe(s))||s===PS.DEFAULT)s=m;else{if("number"!==b)return fr(a+"format argument invalid");if((s=Math.floor(s))<1||4<s)return fr(a+"format argument is not 1, 2, 3 or 4")}if("undefined"===(b=Oe(f))||f===PS.DEFAULT)f=P;else{if("number"!==b)return fr(a+"length argument invalid");(f=Math.floor(f))<1&&(f=1),E<f&&(f=E)}if((d=_e(i,PS.ERROR,!0,!0))===PS.ERROR)return fr(a+"hex argument invalid");if(v="\nvar myImage = {\n\twidth : "+P+", height : "+p+", pixelSize : "+s+",\n\tdata : [",E<1)return v+="]\n};\n",PS.debug(v),PS.DONE;for(v+="\n\t",A=255,U=y=0,D=S*(T=g*m)+R*m,C=0;C<p;C+=1){for(x=D,L=0;L<P;L+=1)m<3?((M=h[x])<1?N=w=F=0:16777215<=M?N=w=F=255:(N=M/le,w=(M-(O=(N=Math.floor(N))*le))/se,F=M-O-(w=Math.floor(w))*se),2===m&&(A=h[x+1])):(N=h[x],w=h[x+1],F=h[x+2],M=N*le+w*se+F,4===m&&(A=h[x+3])),v+=(I=d,k=M,K=N,B=w,Y=F,z=A,W=void 0,(_=s)<3?(W="",W+=I?Jt(k,6):k,2===_&&(W+=I?", "+Jt(z,2):", "+z)):(W=I?Jt(K,2)+", "+Jt(B,2)+", "+Jt(Y,2):K+", "+B+", "+Y,4===_&&(W+=I?", "+Jt(z,2):", "+z)),W),(U+=1)<E&&(v+=",",(y+=1)<f?v+=" ":(y=0,v+="\n\t")),x+=m;D+=T}return v+="\n\t]\n};\n",PS.debug(v),PS.DONE},spriteSolid:function(e,r){var t,n,i,a,o;if(t="[PS.spriteSolid] ",(n=arguments.length)<2)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many argument(s)");if(a=r,(i=e)===PS.DEFAULT)i=1;else{if("number"!==Oe(i))return fr(t+"width argument invalid");(i=Math.floor(i))<1&&(i=1)}if(a===PS.DEFAULT)a=1;else{if("number"!==Oe(a))return fr(t+"height argument invalid");(a=Math.floor(a))<1&&(a=1)}return(o=Xt()).width=i,o.height=a,o.color={rgb:0,r:0,g:0,b:0,a:255},o.id},spriteSolidColor:function(e,r,t,n){var i,a,o,u,l,s,f,d,g;return i="[PS.spriteSolidColor] ",(a=arguments.length)<1?fr(i+"Missing argument(s)"):4<a?fr(i+"Too many argument(s)"):(o=$t(e,i))===PS.ERROR?PS.ERROR:(l=o.color)?(u=Ur(i,r,t,n))===PS.ERROR?PS.ERROR:((s=u.rgb)!==PS.CURRENT&&(null===s?((f=u.r)===PS.CURRENT?u.r=f=l.r:f===PS.DEFAULT&&(u.r=f=0),(d=u.g)===PS.CURRENT?u.g=d=l.g:d===PS.DEFAULT&&(u.g=d=0),(g=u.b)===PS.CURRENT?u.b=g=l.b:g===PS.DEFAULT&&(u.b=g=0),u.rgb=s=f*le+d*se+g):s===PS.DEFAULT&&(u.rgb=s=0,u.r=0,u.g=0,u.b=0),l.rgb!==s&&(l.rgb=s,l.r=u.r,l.g=u.g,l.b=u.b,o.visible&&o.placed&&(en(o),nr()))),l.rgb):fr(i+"Cannot set color of image sprite "+o.id)},spriteSolidAlpha:function(e,r){var t,n,i,a,o,u;if(t="[PS.spriteSolidAlpha] ",(n=arguments.length)<1)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many argument(s)");if(i=r,(a=$t(e,t))===PS.ERROR)return PS.ERROR;if(!(o=a.color))return fr(t+"Cannot set alpha of image sprite "+a.id);if("undefined"!==(u=Oe(i))&&i!==PS.CURRENT){if(i===PS.DEFAULT)i=255;else{if("number"!==u)return fr(t+"alpha argument invalid");(i=Math.floor(i))<0?i=0:255<i&&(i=255)}o.a!==i&&(o.a=i,a.visible&&a.placed&&(en(a),nr()))}return o.a},spriteImage:function(e,r){var t,n,i,a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E,v,T,y,U,A;if(t="[PS.spriteImage] ",(n=arguments.length)<1)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many argument(s)");if(Vt(t,e)===PS.ERROR)return PS.ERROR;if(f=s=0,d=i=e.width,g=a=e.height,o=e.pixelSize,u=e.data,"undefined"!==(l=Oe(r))&&r!==PS.DEFAULT){if("object"!==l)return fr(t+"region argument invalid");if("undefined"===(l=Oe(f=r.left))||f===PS.DEFAULT)f=0;else{if("number"!==l)return fr(t+"region.left invalid");if((f=Math.floor(f))<0)f=0;else if(i<=f)return fr(t+"region.left outside image")}if("undefined"===(l=Oe(s=r.top))||s===PS.DEFAULT)s=0;else{if("number"!==l)return fr(t+"region.top invalid");if((s=Math.floor(s))<0)s=0;else if(a<=s)return fr(t+"region.top outside image")}if("undefined"===(l=Oe(d=r.width))||d===PS.DEFAULT)d=i-f;else{if("number"!==l)return fr(t+"region.width invalid");((d=Math.floor(d))<1||i<f+d)&&(d=i-f)}if("undefined"===(l=Oe(g=r.height))||g===PS.DEFAULT)g=a-s;else{if("number"!==l)return fr(t+"region.height invalid");((g=Math.floor(g))<1||a<s+g)&&(g=a-s)}}for((c=[]).length=d*g*4,y=255,h=s*(m=i*o)+f*o,R=P=0;R<g;R+=1){for(b=h,S=0;S<d;S+=1)o<3?((p=u[b])<1?p=E=v=T=0:16777215<=p?(p=16777215,E=v=T=255):(E=p/le,v=(p-(U=(E=Math.floor(E))*le))/se,T=p-U-(v=Math.floor(v))*se),2===o&&(y=u[b+1])):(E=u[b],v=u[b+1],T=u[b+2],4===o&&(y=u[b+3])),c[P]=E,c[P+1]=v,c[P+2]=T,c[P+3]=y,b+=o,P+=4;h+=m}return(A=Xt()).width=d,A.height=g,A.image={id:oe+be,width:d,height:g,pixelSize:4,data:c},be+=1,A.id},spriteShow:function(e,r){var t,n,i,a,o;return t="[PS.spriteShow] ",(n=arguments.length)<1?fr(t+"Missing argument(s)"):2<n?fr(t+"Too many argument(s)"):(o=$t(i=e,t))===PS.ERROR?PS.ERROR:(a=_e(r,PS.CURRENT,!0,PS.CURRENT))===PS.ERROR?fr(t+"show argument invalid"):(a!==PS.CURRENT&&o.visible!==a&&(o.visible=a,o.placed&&(a?(en(o),rn(o,i)):Zt(o),nr())),o.visible)},spriteAxis:function(e,r,t){var n,i,a,o,u,l,s;if(n="[PS.spriteAxis] ",(i=arguments.length)<1)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many argument(s)");if(o=r,u=t,(l=$t(a=e,n))===PS.ERROR)return PS.ERROR;if("undefined"===(s=Oe(o))||o===PS.CURRENT)o=l.ax;else if(o===PS.DEFAULT)o=0;else{if("number"!==s)return fr(n+"x argument invalid");o=Math.floor(o)}if("undefined"===(s=Oe(u))||u===PS.CURRENT)u=l.ay;else if(u===PS.DEFAULT)u=0;else{if("number"!==s)return fr(n+"y argument invalid");u=Math.floor(u)}return o===l.ax&&u===l.ay||(l.ax=o,l.ay=u,l.visible&&l.placed&&(en(l),rn(l,a),nr())),{x:l.ax,y:l.ay}},spritePlane:function(e,r){var t,n,i,a,o;if(t="[PS.spritePlane] ",(n=arguments.length)<1)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many arguments");if(i=r,(a=$t(e,t))===PS.ERROR)return PS.ERROR;if("undefined"!==(o=Oe(i))&&i!==PS.CURRENT){if(i===PS.DEFAULT)i=0;else{if("number"!==o)return fr(t+"plane argument invalid");(i=Math.floor(i))<1&&(i=0)}a.plane!==i&&(a.visible&&a.placed&&Zt(a),a.plane=i,a.visible&&a.placed&&(en(a),nr()))}return a.plane<0?0:a.plane},spriteMove:function(e,r,t){var n,i,a,o,u,l,s,f,d,g,c,m,h,b,S,R;if(n="[PS.spriteMove] ",(i=arguments.length)<1)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many argument(s)");if(o=r,u=t,(l=$t(a=e,n))===PS.ERROR)return PS.ERROR;if("undefined"===(s=Oe(o))||o===PS.CURRENT)o=l.x;else if(o===PS.DEFAULT)o=0;else{if("number"!==s)return fr(n+"x argument invalid");o=Math.floor(o)}if("undefined"===(s=Oe(u))||u===PS.CURRENT)u=l.y;else if(u===PS.DEFAULT)u=0;else{if("number"!==s)return fr(n+"y argument invalid");u=Math.floor(u)}return l.placed&&o===l.x&&u===l.y||(R=!1,l.plane<0&&(l.plane=k.plane),l.visible&&l.placed&&(d=l.y,c=l.height,o>l.x?(g=o-l.x,f=l.x):l.x>o?(g=l.x-o,f=l.x+l.width-g):g=0,g>=l.width?(R=!0,Zt(l)):(m=l.x,b=l.width,u>l.y?(S=u-l.y,h=l.y):l.y>u?(S=l.y-u,h=l.y+l.height-S):S=0,S>=l.height?(R=!0,Zt(l)):S<1?(R=!0,Zt(l,f,d,g,c)):(b<1?R=!0:(R=!0,b-=g,o>l.x&&(m+=g),Zt(l,f,d,g,c)),Zt(l,m,h,b,S)))),l.x=o,l.y=u,l.placed=!0,l.visible&&(R=!0,en(l),rn(l,a)),R&&nr()),{x:l.x,y:l.y}},spriteCollide:function(e,r){var t,n,i,a,o;if(t="[PS.spriteCollide] ",(n=arguments.length)<1)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many arguments");if((i=$t(e,t))===PS.ERROR)return PS.ERROR;if("undefined"!==(o=Oe(a=r))&&a!==PS.CURRENT){if(a===PS.DEFAULT)a=null;else if("function"!==o)return fr(t+"exec argument not a function");i.collide!==a&&(i.collide=a)&&i.visible&&i.placed&&rn(i,e)}return i.collide},spriteDelete:function(e){var r,t,n,i,a;if(r="[PS.spriteDelete] ",(t=arguments.length)<1)return fr(r+"Missing argument");if(1<t)return fr(r+"Too many arguments");if("string"!=typeof e||e.length<1)return fr(r+"sprite argument invalid");for(n=O.length,i=0;i<n;i+=1)if((a=O[i]).id===e)return Zt(a),O.splice(i,1),nr(),PS.DONE;return fr(r+"sprite id '"+e+"' not found")},audioLoad:function(e,r){var t,n,i,a,o,u;if(t="[PS.audioLoad] ",(n=arguments.length)<1)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many arguments");if(a=r,"string"!==Oe(i=e))return fr(t+"filename argument invalid");if(i.length<1)return PS.DONE;if(void 0===a)a={};else if("object"!==Oe(a))return fr(t+"params argument invalid");if(null==(o=a.path)||o===PS.DEFAULT)a.path=de.audio.path;else{if("string"!==Oe(o))return fr(t+"params.path property invalid");o.length<1&&(a.path=de.audio.path)}return(u=AQ.load(i,a))===AQ.ERROR?PS.ERROR:u},audioPlay:function(e,r){var t,n,i,a,o,u;if(t="[PS.audioPlay] ",(n=arguments.length)<1)return fr(t+"Missing argument(s)");if(2<n)return fr(t+"Too many arguments");if(a=r,"string"!==Oe(i=e))return fr(t+"filename argument invalid");if(i.length<1)return PS.DONE;if(void 0===a)a={};else if("object"!==Oe(a))return fr(t+"params argument invalid");if(null==(o=a.path)||o===PS.DEFAULT)a.path=de.audio.path;else{if("string"!==Oe(o))return fr(t+"params.path property invalid");o.length<1&&(a.path=de.audio.path)}return a.autoplay=!0,(u=AQ.load(i,a))===AQ.ERROR?PS.ERROR:u},audioPause:function(e){var r,t,n;return r="[PS.audioPause] ",(t=arguments.length)<1?fr(r+"Missing argument(s)"):1<t?fr(r+"Too many arguments"):(n=AQ.pause(e))===AQ.ERROR?PS.ERROR:n},audioStop:function(e){var r,t,n;return r="[PS.audioStop] ",(t=arguments.length)<1?fr(r+"Missing argument(s)"):1<t?fr(r+"Too many arguments"):(n=AQ.stop(e))===AQ.ERROR?PS.ERROR:n===AQ.DONE?PS.DONE:n},piano:function(e,r){var t,n,i,a,o,u;if(t="[PS.piano] ",n=l.length,"number"!==(i=Oe(a=e)))return fr(t+"index argument invalid");if((a=Math.floor(a))<1?a=1:n<a&&(a=n),!0!==(o=r)&&!1!==o)if("undefined"===(i=Oe(o)))o=!1;else if("number"!==i)return fr(t+"flag argument invalid");return u="piano_"+l[a-1],o&&(u="l_"+u),u},harpsichord:function(e,r){var t,n,i,a,o,u;if(t="[PS.harpsichord] ",n=f.length,"number"!==(i=Oe(a=e)))return fr(t+"index argument invalid");if((a=Math.floor(a))<1?a=1:n<a&&(a=n),!0!==(o=r)&&!1!==o)if("undefined"===(i=Oe(o)))o=!1;else if("number"!==i)return fr(t+"flag argument invalid");return u="hchord_"+f[a-1],o&&(u="l_"+u),u},xylophone:function(e){var r,t;return"[PS.xylophone] ",r=n.length,"number"!==Oe(t=e)?fr("[PS.xylophone] index argument invalid"):((t=Math.floor(t))<1?t=1:r<t&&(t=r),"xylo_"+n[t-1])},debug:function(e){var r,t,n,i;return"[PS.debug] ",1<arguments.length?fr("[PS.debug] Too many arguments"):("undefined"===(t=Oe(r=e))?r="":"string"!==t&&(r=r.toString()),we||(Le.style.display="inline",Ne.value="",Fe=!(we=!0)),0<r.length&&((n=document.getElementById(ae)).value+=r,n.scrollTop=n.scrollHeight,console&&console.log&&console.log(r)),(i=document.getElementById(X)).scrollTop=i.scrollHeight,PS.DONE)},debugClose:function(){return"[PS.debugClose] ",0<arguments.length?fr("[PS.debugClose] Too many arguments"):(document.getElementById(ie).style.display="none",we=!1,PS.DONE)},debugClear:function(){return"[PS.debugClear] ",0<arguments.length?fr("[PS.debugClear] Too many arguments"):(Ne.value="",PS.DONE)},line:function(e,r,t,n){var i,a,o,u,l,s;return i="[PS.line] ",(a=arguments.length)<4?fr(i+"Missing argument(s)"):4<a?fr(i+"Too many arguments"):(u=r,l=t,s=n,"number"!==Oe(o=e)?fr(i+"x1 argument not a number"):(o=Math.floor(o),"number"!==Oe(u)?fr(i+"y1 argument not a number"):(u=Math.floor(u),"number"!==Oe(l)?fr(i+"x2 argument not a number"):(l=Math.floor(l),"number"!==Oe(s)?fr(i+"y2 argument not a number"):function(e,r,t,n){var i,a,o,u,l,s,f;for(o=e<t?1:-1,u=r<n?1:-1,l=(i=e<t?t-e:e-t)-(a=r<n?n-r:r-n),f=[];e!==t||r!==n;){if(-a<(s=2*l)&&(l-=a,e+=o),e===t&&r===n){f.push([e,r]);break}s<i&&(l+=i,r+=u),f.push([e,r])}return f}(o,u,l,s=Math.floor(s))))))},pathMap:function(e){var r,t;return r="[PS.pathMap] ",(t=arguments.length)<1?fr(r+"Missing argument(s)"):1<t?fr(r+"Too many arguments"):Vt(r,e)===PS.ERROR?PS.ERROR:1!==e.pixelSize?fr(r+"image is not format 1"):function(e,r,t){var n,i,a,o,u,l,s,f;for(i=t.length,(n=[]).length=i,u=a=0;u<r;u+=1)for(o=0;o<e;o+=1)l={x:o,y:u,value:s=t[a],ovalue:s,f:0,g:0,h:0,cost:0,parent:null,closed:!1,visited:!1},n[a]=l,a+=1;return f={id:"pathmap_"+Me,width:e,height:r,nodes:n},Me+=1,V.push(f),f}(e.width,e.height,e.data).id},pathFind:function(e,r,t,n,i,a){var o,u,l,s,f,d,g,c,m,h,b,S,R;if(o="[PS.pathFind] ",(u=arguments.length)<5)return fr(o+"Missing argument(s)");if(6<u)return fr(o+"Too many arguments");if(s=r,f=t,d=n,g=i,c=a,!(l=e)||"string"!=typeof l||l.length<1)return fr(o+"pathmap argument invalid");if(!(m=on(l)))return fr(o+l+" not found");if("number"!==Oe(s))return fr(o+"x1 argument not a number");if((s=Math.floor(s))<0||s>=m.width)return fr(o+"x1 argument is outside "+l);if("number"!==Oe(f))return fr(o+"y1 argument not a number");if((f=Math.floor(f))<0||f>=m.height)return fr(o+"y1 argument is outside "+l);if("number"!==Oe(d))return fr(o+"x2 argument not a number");if((d=Math.floor(d))<0||d>=m.width)return fr(o+"x2 argument is outside "+l);if("number"!==Oe(g))return fr(o+"y2 argument not a number");if((g=Math.floor(g))<0||g>=m.height)return fr(o+"y2 argument is outside "+l);if(R=S=!1,"undefined"!==(h=Oe(c))&&c!==PS.DEFAULT){if("object"!==h)return fr(o+"options argument invalid");if(!0===(b=c.no_diagonals)||!1===b)S=b;else if("undefined"===(h=Oe(b))||b===PS.DEFAULT)S=!1;else{if("number"!==h)return fr(o+"options.no_diagonals invalid");S=0!==b}if(!0===(b=c.cut_corners)||!1===b)R=b;else if("undefined"===(h=Oe(b))||b===PS.DEFAULT)R=!1;else{if("number"!==h)return fr(o+"options.cut_corners invalid");R=0!==b}}return function(e,r,t,n,i,a,o){var u,l,s,f,d,g,c,m,h,b,S,R,P,p,E,v,T,y,U,A,D,x,C,L,N,w,F,M,O,_,I,k,K,B,Y;if(r===n&&t===i)return[];if(u=e.width,l=e.height,!(f=(s=e.nodes)[t*u+r]).value)return[];if(!(f=s[i*u+n]).value)return[];if(!a&&(d=function(e,r,t,n,i,a){var o,u,l,s,f,d,g;for(l=t<i?1:-1,s=n<a?1:-1,f=(o=t<i?i-t:t-i)-(u=n<a?a-n:n-a),g=[];t!==i||n!==a;){if(-u<(d=2*f)&&(f-=u,t+=l),t===i&&n===a)return g.push([t,n]),g;if(d<o&&(f+=o,n+=s),!e[n*r+t].value)return null;g.push([t,n])}return g}(s,u,r,t,n,i)))return d;for(g=s.length,S=0;S<g;S+=1)(f=s[S]).f=0,f.g=0,f.h=0,f.cost=0,f.closed=!1,f.visited=!1,f.parent=null;for(d=[],c=new tn(an),f=s[t*u+r],c.push(f);0<c.size();){if((m=c.pop()).x===n&&m.y===i){for(E=m;E.parent;)d.push([E.x,E.y]),E=E.parent;d.reverse();break}for(m.closed=!0,v=s,T=u,y=l,A=a,D=o,Y=B=K=k=I=_=O=M=F=w=N=L=C=x=void 0,x=[],C=(U=m).x,N=T-1,w=y-1,O=(L=U.y)*T,F=(L-1)*T,M=(L+1)*T,Y=B=K=k=!1,0<C&&((I=v[O+(_=C-1)]).value?I.closed||(I.cost=I.value,x.push(I)):Y=!0),C<N&&((I=v[O+(_=C+1)]).value?I.closed||(I.cost=I.value,x.push(I)):B=!0),0<L&&((I=v[F+C]).value?I.closed||(I.cost=I.value,x.push(I)):k=!0),L<w&&((I=v[M+C]).value?I.closed||(I.cost=I.value,x.push(I)):K=!0),A||(0<C&&(_=C-1,0<L&&(D||!Y&&!k)&&(I=v[F+_]).value&&!I.closed&&(I.cost=I.value*fe,x.push(I)),L<w&&(D||!Y&&!K)&&(I=v[M+_]).value&&!I.closed&&(I.cost=I.value*fe,x.push(I))),C<N&&(_=C+1,0<L&&(D||!k&&!B)&&(I=v[F+_]).value&&!I.closed&&(I.cost=I.value*fe,x.push(I)),L<w&&(D||!K&&!B)&&(I=v[M+_]).value&&!I.closed&&(I.cost=I.value*fe,x.push(I)))),b=(h=x).length,S=0;S<b;S+=1)R=h[S],P=m.g+R.cost,(!(p=R.visited)||P<R.g)&&(R.visited=!0,R.parent=m,R.h=R.h||nn(R.x,R.y,n,i),R.g=P,R.f=R.g+R.h,p?c.rescore(R):c.push(R))}return d}(m,s,f,d,g,S,R)},pathData:function(e,r,t,n,i,a){var o,u,l,s,f,d,g,c,m,h,b;if(o="[PS.pathData] ",(u=arguments.length)<5)return fr(o+"Missing argument(s)");if(6<u)return fr(o+"Too many arguments");if(s=r,f=t,d=n,g=i,c=a,!(l=e)||"string"!=typeof l||l.length<1)return fr(o+"pathmap argument invalid");if(!(m=on(l)))return fr(o+l+" not found");if("number"!==Oe(s))return fr(o+"left argument not a number");if((s=Math.floor(s))<0||s>=m.width)return fr(o+"left argument is outside "+l);if("number"!==Oe(f))return fr(o+"top argument not a number");if((f=Math.floor(f))<0||f>=m.height)return fr(o+"top argument is outside "+l);if(d===PS.DEFAULT)d=1;else{if("number"!==Oe(d))return fr(o+"width argument not a number");(d=Math.floor(d))<1?d=1:(h=m.width-s)<d&&(d=h)}if(g===PS.DEFAULT)g=1;else{if("number"!==Oe(g))return fr(o+"height argument not a number");(g=Math.floor(g))<1?g=1:(h=m.height-f)<g&&(g=h)}if(c!==PS.DEFAULT&&c!==PS.CURRENT)if("undefined"===(b=Oe(c)))c=PS.CURRENT;else{if("number"!==b)return fr(o+"data argument not a number");if(c<0)return fr(o+"data argument < 0")}return function(e,r,t,n,i,a){var o,u,l,s,f,d,g,c;for((o=[]).length=n*i,u=e.nodes,l=t+i,g=0,d=t;d<l;d+=1)for(s=d*e.width+r,f=0;f<n;f+=1)c=u[s],a!==PS.CURRENT&&(a===PS.DEFAULT?c.value=c.ovalue:c.value=a),o[g]=c.value,g+=1,s+=1;return o}(m,s,f,d,g,c)},pathDelete:function(e){var r;return r="[PS.pathDelete] ",arguments.length<1?fr(r+"Missing argument"):!e||"string"!=typeof e||e.length<1?fr(r+"pathmap argument invalid"):function(e){var r,t,n,i,a;for(r=V.length,t=0;t<r;t+=1)if((n=V[t]).id===e){for(r=(i=n.nodes).length,a=0;a<r;a+=1)i[a]=null;return n.nodes=null,V.splice(t,1),!0}return!1}(e)?PS.DONE:fr(r+e+" not found")},pathNear:function(e,r,t,n,i){var a,o,u;return a="[PS.pathNear] ",(o=arguments.length)<5?fr(a+"Missing argument(s)"):5<o?fr(a+"Too many arguments"):!e||"string"!=typeof e||e.length<1?fr(a+"pathmap argument invalid"):(u=on(e))?function(e,r,t,n,i){var a,o,u,l,s,f,d,g,c,m,h,b,S,R,P,p,E,v,T;for(a=e.nodes,o=e.width,u=e.height,l=1;l<o;){if(s=[],c=i+l,(m=f=n-l)<0&&(m=0),o<=(h=(g=n+l)+1)&&(h=o),0<=(d=i-l))for(b=d*o+m,S=m;S<h;S+=1)(R=a[b]).value&&s.push([R.x,R.y]),b+=1;if(c<u)for(b=c*o+m,S=m;S<h;S+=1)(R=a[b]).value&&s.push([R.x,R.y]),b+=1;if((m=d+1)<0&&(m=0),u<=(h=c)&&(h=u),0<=f)for(b=m*o+f,S=m;S<h;S+=1)(R=a[b]).value&&s.push([R.x,R.y]),b+=o;if(g<o)for(b=m*o+g,S=m;S<h;S+=1)(R=a[b]).value&&s.push([R.x,R.y]),b+=o;if(P=s.length){if(1===P)return s[0];for(p=o+u,S=0;S<P;S+=1)(v=nn(r,t,(T=s[S])[0],T[1]))<p&&(p=v,E=S);return s[E]}l+=1}return[r,t]}(u,r,t,n,i):fr(a+e+" not found")},dbInit:function(e,r){var n,t,i,a,o,u,l,s;if(n="[PS.dbInit] ",(t=arguments.length)<1)return fr(n+"Missing argument(s)");if(2<t)return fr(n+"Too many arguments");if(!e||"string"!=typeof e||e.length<1)return fr(n+"Database id invalid");if((i=e.toLowerCase())===bn.TIME_LABEL)return fr(n+"Database id '"+bn.TIME_LABEL+"' is reserved");if(bn.validID(i))return fr(n+"Database id '"+i+"' already exists");if(u=!1,s=null,a=function(e){var r,t;if(!e||"string"!=typeof e||e.length<1?(Pr("WARNING: Invalid user ID"),t=bn.init(i,null,u)):(r=e.toLowerCase(),K.PS.USERS[r]?t=bn.init(i,r,u):(Pr("WARNING: Unauthorized user ID"),t=bn.init(i,null,u))),s&&"function"==typeof s)try{s(t)}catch(e){return sr(n+"Callback function failed ["+e.message+"]",e)}return t},o=function(e){return PS.statusInput("User ID:",a)===PS.ERROR?PS.ERROR:e},K&&r&&r!==PS.DEFAULT){if(T(r)!==PS.ERROR)return(l=PS.statusInput("User ID:",a))===PS.ERROR?PS.ERROR:i;if("object"!==Oe(r))return fr(n+"options parameter invalid");if((l=r.discard)!==PS.DEFAULT&&(u=T(r.discard))===PS.ERROR)return fr(n+"options.discard property is not a Boolean");if((l=r.login)!==PS.DEFAULT){if((l=T(s=r.login))===PS.ERROR)return"function"==typeof s?o(i):fr(n+"options.login property is not a boolean or function");if(l)return s=null,o(i)}}return bn.init(i,null,u)},dbValid:function(e){return bn.validID(e)},dbErase:function(e){var r,t,n;return r="[PS.dbErase] ",(t=arguments.length)<1?fr(r+"Missing argument"):1<t?fr(r+"Too many arguments"):!e||"string"!=typeof e||e.length<1?fr(r+"Database id invalid"):(n=e.toLowerCase(),bn.validID(n)?(bn.erase(n),n):fr(r+"Database id '"+n+"' does not exist"))},dbEvent:function(e){var r,t,n,i,a,o,u,l,s,f;if(r="[PS.dbEvent] ",(t=arguments.length)<3)return fr(r+"Missing arguments");if(!e||"string"!=typeof e||e.length<1)return fr(r+"Database id invalid");if(n=e.toLowerCase(),!bn.validID(n))return fr(r+"Database id '"+n+"' does not exist");for(a={},o=[],i=1;i<t;){if(!(u=arguments[i])||"string"!=typeof u||u.length<1)return fr(r+"Event name @ argument "+i+" invalid");if((u=u.toLowerCase())===bn.TIME_LABEL)return fr(r+"Event label '"+bn.TIME_LABEL+"' is reserved");if(a.hasOwnProperty(u))return fr(r+"Duplicate event '"+u+"' @ argument "+i);if(a[u]=!0,t<=(l=i+1))return fr(r+"Missing value for event '"+u+"'");if(o.push(u),"number"!==(f=Oe(s=arguments[l]))&&"string"!==f&&!0!==s&&!1!==s&&null!==s)return fr(r+"Illegal value type for event '"+u+"'");o.push(s),i+=2}return bn.event(n,o)},dbData:function(e){var r,t;return r="[PS.dbData] ",(t=arguments.length)<1?fr(r+"Missing argument"):1<t?fr(r+"Too many arguments"):!e||"string"!=typeof e||e.length<1?fr(r+"Database id invalid"):(e=e.toLowerCase(),bn.validID(e)?bn.store[e]:fr(r+"Database id '"+e+"' does not exist"))},dbDump:function(e){var r,t,n;return r="[PS.dbDump] ",(t=arguments.length)<1?fr(r+"Missing argument"):1<t?fr(r+"Too many arguments"):!e||"string"!=typeof e||e.length<1?fr(r+"Database id invalid"):(e=e.toLowerCase(),bn.validID(e)?(n=bn.csv(r,e))===PS.ERROR?n:(PS.debug(n),e):fr(r+"Database id '"+e+"' does not exist"))},dbSend:function(e,r,t){var n,i,a,o,u,l,s,f,d;if(n="[PS.dbSend] ",(i=arguments.length)<2)return fr(n+"Missing argument(s)");if(3<i)return fr(n+"Too many arguments");if(!K)return fr(n+"Knecht server unavailable");if(!e||"string"!=typeof e||e.length<1)return fr(n+"Database id invalid");if(a=e.toLowerCase(),!bn.validID(a))return fr(n+"Database id '"+a+"' does not exist");if("string"===(o=Oe(r))){if(r.length<1)return fr(n+"Username string is empty");if(u=r.toLowerCase(),!K.PS.USERS[u])return fr(n+"Unauthorized user id '"+u+"'");d=u,f=[K.PS.addSuffix(u)]}else{if("array"!==o)return fr(n+"Username argument is not a string or array");if((l=r.length)<1)return fr(n+"Username array is empty");for(f=[],s=0;s<l;s+=1){if(!(u=r[s])||"string"!=typeof u||u.length<1)return fr(n+"username["+s+"] not a valid string");if(u=u.toLowerCase(),!K.PS.USERS[u])return fr(n+"Unauthorized user id @ username["+s+"]: '"+u+"'");s||(d=u),f.push(K.PS.addSuffix(u))}}if(t){if("object"!==Oe(t))return fr(n+"Options argument is not an object");if((u=t.message)&&u!==PS.DEFAULT){if("string"!=typeof u)return fr(n+"options.message is not a valid string")}else t.message="Sending database '"+a+"' ...";if(!0!==(u=t.discard)&&!1!==u){if(null==u||u===PS.DEFAULT)t.discard=!1;else if("number"!==Oe(u))return fr(n+"options.discard invalid");t.discard=0!==u}}return bn.emails(n,a,f,d,t)},_footerText:function(e){var r,t;return"[PS._footerText] ",1<arguments.length?fr("[PS._footerText] Too many arguments"):(t=Oe(r=e),r!==PS.CURRENT&&"undefined"!==t&&(r===PS.DEFAULT?r="":"string"!==t&&(r=r.toString()),ur(),lr(r)),g)}}}();!function(){"use strict";var i,e,r,t;for(e=["webkit","moz","ms","o"],r=i=0;r<e.length&&!window.requestAnimationFrame;r+=1)t=e[r],window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var r,t,n;return r=(new Date).getTime(),t=Math.max(0,16-(r-i)),n=window.setTimeout(function(){e(r+t)},t),i=r+t,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){window.clearTimeout(e)})}(),String.fromCodePoint||function(){"use strict";var e,r;r=function(){var e,r,t,n,i,a,o;if(!(e=arguments.length))return"";for(16384,r="",n=[],t=0;t<e;){if(i=Number(arguments[t]),!isFinite(i)||i<0||1114111<i||Math.floor(i)!==i)throw RangeError("Invalid code point: "+i);i<=65535?n.push(i):(a=55296+((i-=65536)>>10),o=i%1024+56320,n.push(a,o)),(t+1===e||16384<n.length)&&(r+=String.fromCharCode.apply(null,n),n.length=0),t+=1}return r},(e=function(){var e,r,t;e={},r=Object.defineProperty;try{t=r(e,e,e)&&r}catch(e){}return t}())?e(String,"fromCodePoint",{value:r,configurable:!0,writable:!0}):String.fromCodePoint=r}();
